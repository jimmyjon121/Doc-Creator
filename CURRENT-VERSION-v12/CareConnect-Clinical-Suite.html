<!DOCTYPE html>

<!-- 
    CareConnect Pro - Clinical Aftercare Planning Suite
    Version: 1.0.0
    Built: 2025-10-15T01:16:14.195Z
    HIPAA Compliant: No PHI stored
    License: Proprietary
-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect Pro - Clinical Aftercare Planning Suite</title>
    
    <!-- Styles -->
    
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon.png">

<style>
/* Embedded Clinical Suite Styles */
/* clinical-suite.css - Professional styling for CareConnect Pro Clinical Suite */

:root {
    /* Clinical color palette */
    --primary-blue: #0056b3;
    --primary-teal: #17a2b8;
    --secondary-gray: #6c757d;
    --success-green: #28a745;
    --warning-amber: #ffc107;
    --danger-red: #dc3545;
    
    /* Background colors */
    --bg-primary: #ffffff;
    --bg-secondary: #f8f9fa;
    --bg-tertiary: #e9ecef;
    
    /* Text colors */
    --text-primary: #212529;
    --text-secondary: #495057;
    --text-muted: #6c757d;
    
    /* Border colors */
    --border-light: #dee2e6;
    --border-medium: #adb5bd;
    --border-dark: #495057;
    
    /* Shadows */
    --shadow-sm: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
    --shadow-md: 0 0.5rem 1rem rgba(0,0,0,0.15);
    --shadow-lg: 0 1rem 3rem rgba(0,0,0,0.175);
}

/* ============= LAYOUT ============= */

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    line-height: 1.6;
}

.app-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* ============= SESSION HEADER ============= */

.session-header {
    background: var(--bg-primary);
    border-bottom: 3px solid var(--primary-blue);
    padding: 15px 20px;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-sm);
}

.session-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.session-id {
    font-weight: 600;
    color: var(--primary-blue);
    font-size: 14px;
}

.session-clinician {
    color: var(--text-secondary);
}

.session-timer {
    background: var(--bg-tertiary);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
}

.btn-end-session {
    background: var(--danger-red);
    color: white;
    border: none;
    padding: 6px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s ease;
}

.btn-end-session:hover {
    background: #c82333;
    transform: translateY(-1px);
}

.session-warning {
    background: #fff3cd;
    color: #856404;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* ============= NAVIGATION TABS ============= */

.nav-tabs {
    display: flex;
    background: var(--bg-primary);
    border-radius: 8px 8px 0 0;
    overflow: hidden;
    margin-top: 20px;
    box-shadow: var(--shadow-sm);
}

.nav-tab {
    flex: 1;
    padding: 15px 20px;
    background: var(--bg-secondary);
    border: none;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-secondary);
    transition: all 0.3s ease;
    border-right: 1px solid var(--border-light);
}

.nav-tab:last-child {
    border-right: none;
}

.nav-tab:hover {
    background: var(--bg-tertiary);
}

.nav-tab.active {
    background: var(--bg-primary);
    color: var(--primary-blue);
    border-bottom: 3px solid var(--primary-blue);
}

.nav-tab-icon {
    margin-right: 8px;
}

.nav-tab-badge {
    background: var(--primary-blue);
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    margin-left: 8px;
}

/* ============= PROGRAM CARDS ============= */

.programs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.program-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 20px;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
    position: relative;
}

.program-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.program-card.selected {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.2);
}

.program-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 15px;
}

.program-name {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.program-location {
    color: var(--text-muted);
    font-size: 14px;
    margin-top: 4px;
}

.program-actions {
    display: flex;
    gap: 8px;
}

.btn-program-action {
    padding: 6px 10px;
    border: 1px solid var(--border-light);
    background: var(--bg-primary);
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
}

.btn-program-action:hover {
    background: var(--bg-secondary);
}

.btn-compare {
    color: var(--primary-blue);
    border-color: var(--primary-blue);
}

.btn-compare.active {
    background: var(--primary-blue);
    color: white;
}

.program-details {
    border-top: 1px solid var(--border-light);
    padding-top: 15px;
}

.detail-row {
    display: flex;
    margin-bottom: 10px;
}

.detail-label {
    font-weight: 500;
    color: var(--text-secondary);
    min-width: 120px;
    font-size: 13px;
}

.detail-value {
    color: var(--text-primary);
    font-size: 13px;
}

.detail-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 4px;
}

.detail-tag {
    background: var(--bg-tertiary);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    color: var(--text-secondary);
}

.detail-tag.evidence-based {
    background: #d4edda;
    color: #155724;
}

.detail-tag.experiential {
    background: #d1ecf1;
    color: #0c5460;
}

/* ============= COMPARISON MATRIX ============= */

.comparison-matrix {
    background: var(--bg-primary);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: var(--shadow-md);
    margin-top: 20px;
}

.matrix-header {
    background: var(--primary-blue);
    color: white;
}

.matrix-row {
    display: grid;
    grid-template-columns: 200px repeat(auto-fit, minmax(200px, 1fr));
    border-bottom: 1px solid var(--border-light);
}

.matrix-cell {
    padding: 12px 16px;
    border-right: 1px solid var(--border-light);
}

.matrix-cell:last-child {
    border-right: none;
}

.category-header {
    background: var(--primary-blue);
    color: white;
    font-weight: 600;
}

.program-header {
    background: var(--bg-secondary);
    text-align: center;
}

.program-header h4 {
    margin: 0 0 4px 0;
    color: var(--primary-blue);
}

.program-location {
    font-size: 12px;
    color: var(--text-muted);
}

.matrix-category {
    background: var(--bg-primary);
}

.matrix-category-title {
    background: var(--bg-tertiary);
    padding: 8px 16px;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-medium);
}

.field-label {
    font-weight: 500;
    color: var(--text-secondary);
    background: var(--bg-secondary);
}

.field-value {
    color: var(--text-primary);
}

.field-value.different {
    background: #fff3cd;
}

.boolean-yes {
    color: var(--success-green);
    font-weight: 500;
}

.boolean-no {
    color: var(--text-muted);
}

.insurance-list ul {
    margin: 4px 0 0 20px;
    padding: 0;
    font-size: 12px;
}

.has-major {
    color: var(--success-green);
    font-weight: 500;
    font-size: 12px;
}

/* ============= FILTERS & SEARCH ============= */

.filters-section {
    background: var(--bg-primary);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
}

.filter-groups {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.filter-group {
    border-left: 3px solid var(--primary-blue);
    padding-left: 15px;
}

.filter-group-title {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 10px;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 14px;
}

.filter-checkbox input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
}

.search-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.search-input {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    font-size: 14px;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.1);
}

/* ============= BUTTONS ============= */

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary-blue);
    color: white;
}

.btn-primary:hover {
    background: #004494;
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
}

.btn-secondary:hover {
    background: var(--bg-secondary);
}

.btn-success {
    background: var(--success-green);
    color: white;
}

.btn-warning {
    background: var(--warning-amber);
    color: var(--text-primary);
}

.btn-danger {
    background: var(--danger-red);
    color: white;
}

/* ============= DOCUMENTS ============= */

.document {
    background: white;
    padding: 40px;
    max-width: 800px;
    margin: 0 auto;
    box-shadow: var(--shadow-lg);
    font-family: 'Times New Roman', serif;
}

.document-header {
    border-bottom: 3px solid var(--text-primary);
    padding-bottom: 20px;
    margin-bottom: 30px;
}

.document h1 {
    font-size: 28px;
    text-align: center;
    margin-bottom: 20px;
}

.document h2 {
    font-size: 20px;
    margin-top: 30px;
    margin-bottom: 15px;
    border-bottom: 1px solid var(--border-light);
    padding-bottom: 5px;
}

.document h3 {
    font-size: 16px;
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: 600;
}

.document-meta {
    text-align: right;
    font-size: 12px;
    color: var(--text-secondary);
}

.program-option {
    border: 1px solid var(--border-light);
    padding: 20px;
    margin-bottom: 30px;
    page-break-inside: avoid;
}

/* ============= MODALS ============= */

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: 8px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: var(--shadow-lg);
}

.modal-header {
    margin-bottom: 20px;
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0;
}

.modal-body {
    margin-bottom: 20px;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* ============= NOTIFICATIONS ============= */

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 4px;
    box-shadow: var(--shadow-md);
    z-index: 3000;
    animation: slideIn 0.3s ease;
    max-width: 400px;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.notification.fade-out {
    animation: fadeOut 0.3s ease;
}

@keyframes fadeOut {
    to {
        opacity: 0;
        transform: translateY(-20px);
    }
}

.notification-success {
    background: var(--success-green);
    color: white;
}

.notification-warning {
    background: var(--warning-amber);
    color: var(--text-primary);
}

.notification-error {
    background: var(--danger-red);
    color: white;
}

.notification-info {
    background: var(--primary-blue);
    color: white;
}

/* ============= RESPONSIVE ============= */

@media (max-width: 768px) {
    .programs-grid {
        grid-template-columns: 1fr;
    }
    
    .filter-groups {
        grid-template-columns: 1fr;
    }
    
    .matrix-row {
        grid-template-columns: 1fr;
    }
    
    .nav-tabs {
        flex-direction: column;
    }
    
    .session-info {
        flex-direction: column;
        gap: 10px;
    }
}

/* ============= PRINT STYLES ============= */

@media print {
    body {
        background: white;
    }
    
    .no-print,
    .session-header,
    .nav-tabs,
    .filters-section,
    .btn,
    .program-actions {
        display: none !important;
    }
    
    .document {
        box-shadow: none;
        padding: 0;
    }
    
    .program-card {
        page-break-inside: avoid;
    }
    
    .matrix-row {
        page-break-inside: avoid;
    }
}

</style>
</head>
<body>
    <!-- Session Header (Always Visible) -->
    <div id="session-header" class="session-header" style="display: none;">
        <!-- Populated by SessionManager -->
    </div>
    
    <!-- Main Application Container -->
    <div class="app-container">
        <!-- Application Header -->
        <header class="app-header">
            <h1>CareConnect Pro</h1>
            <p class="app-subtitle">Clinical Aftercare Planning Suite</p>
        </header>
        
        <!-- Start Session Screen -->
        <div id="start-screen" class="start-screen">
            <div class="start-card">
                <h2>Begin Clinical Session</h2>
                <p>This tool assists with aftercare planning and documentation. All session data is temporary and will be cleared when you close this browser tab.</p>
                
                <div class="start-form">
                    <div class="form-group">
                        <label for="clinician-name">Clinician Name (Optional)</label>
                        <input type="text" id="clinician-name" class="form-input" placeholder="Enter your name and credentials">
                    </div>
                    
                    <button class="btn btn-primary btn-large" onclick="startNewSession()">
                        Start New Session
                    </button>
                </div>
                
                <div class="start-info">
                    <h3>Session Information</h3>
                    <ul>
                        <li>A unique session ID will be generated for tracking</li>
                        <li>No patient PHI will be stored on this device</li>
                        <li>Session automatically expires after 30 minutes of inactivity</li>
                        <li>All documents must be exported before closing</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Main Application (Hidden Initially) -->
        <div id="main-app" style="display: none;">
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="programs" onclick="switchTab('programs')">
                    <span class="nav-tab-icon">üìã</span>
                    Programs
                    <span class="nav-tab-badge" id="programs-count">0</span>
                </button>
                <button class="nav-tab" data-tab="compare" onclick="switchTab('compare')">
                    <span class="nav-tab-icon">‚öñÔ∏è</span>
                    Compare
                    <span class="nav-tab-badge" id="compare-count">0</span>
                </button>
                <button class="nav-tab" data-tab="documents" onclick="switchTab('documents')">
                    <span class="nav-tab-icon">üìÑ</span>
                    Documents
                    <span class="nav-tab-badge" id="documents-count">0</span>
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Programs Tab -->
                <div id="programs-tab" class="tab-panel active">
                    <!-- Search and Filters -->
                    <div class="filters-section">
                        <div class="search-bar">
                            <input type="text" class="search-input" id="program-search" 
                                   placeholder="Search programs by name, location, or specialty...">
                            <button class="btn btn-primary" onclick="searchPrograms()">Search</button>
                            <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
                        </div>
                        
                        <div class="filter-groups">
                            <div class="filter-group">
                                <div class="filter-group-title">Level of Care</div>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="residential" onchange="applyFilters()">
                                        Residential
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="php" onchange="applyFilters()">
                                        PHP
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="iop" onchange="applyFilters()">
                                        IOP
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="outpatient" onchange="applyFilters()">
                                        Outpatient
                                    </label>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-group-title">Population</div>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="adolescent" onchange="applyFilters()">
                                        Adolescent
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="young-adult" onchange="applyFilters()">
                                        Young Adult
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="adult" onchange="applyFilters()">
                                        Adult
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="male" onchange="applyFilters()">
                                        Male Only
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="female" onchange="applyFilters()">
                                        Female Only
                                    </label>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-group-title">Specialization</div>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="sud" onchange="applyFilters()">
                                        Substance Use
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="mental-health" onchange="applyFilters()">
                                        Mental Health
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="dual-diagnosis" onchange="applyFilters()">
                                        Dual Diagnosis
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="trauma" onchange="applyFilters()">
                                        Trauma/PTSD
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="eating-disorders" onchange="applyFilters()">
                                        Eating Disorders
                                    </label>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-group-title">Insurance</div>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="bcbs" onchange="applyFilters()">
                                        BCBS
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="aetna" onchange="applyFilters()">
                                        Aetna
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="cigna" onchange="applyFilters()">
                                        Cigna
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="united" onchange="applyFilters()">
                                        United
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="medicaid" onchange="applyFilters()">
                                        Medicaid
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="medicare" onchange="applyFilters()">
                                        Medicare
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Programs Grid -->
                    <div id="programs-grid" class="programs-grid">
                        <!-- Program cards will be populated here -->
                    </div>
                </div>
                
                <!-- Compare Tab -->
                <div id="compare-tab" class="tab-panel" style="display: none;">
                    <div id="comparison-container">
                        <div class="comparison-empty">
                            <p>Select 2-4 programs from the Programs tab to compare</p>
                        </div>
                    </div>
                </div>
                
                <!-- Documents Tab -->
                <div id="documents-tab" class="tab-panel" style="display: none;">
                    <div class="documents-section">
                        <div class="document-actions">
                            <button class="btn btn-primary" onclick="showDocumentWizard('aftercareOptions')">
                                Create Aftercare Options
                            </button>
                            <button class="btn btn-primary" onclick="showDocumentWizard('aftercarePlan')">
                                Create Aftercare Plan
                            </button>
                            <button class="btn btn-primary" onclick="showDocumentWizard('dischargePacket')">
                                Compile Discharge Packet
                            </button>
                        </div>
                        
                        <div id="documents-list" class="documents-list">
                            <!-- Generated documents will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Document Preview Modal -->
    <div id="document-preview-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Document Preview</h2>
                <button class="modal-close" onclick="closeDocumentPreview()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="document-preview-content">
                    <!-- Document content will be inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDocumentPreview()">Close</button>
                <button class="btn btn-primary" onclick="exportDocument('pdf')">Export as PDF</button>
                <button class="btn btn-primary" onclick="exportDocument('word')">Export as Word</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    
    
    
    
    
    <script>
        // Global state
        let currentTab = 'programs';
        let filteredPrograms = [];
        let selectedPrograms = [];
        
        // Initialize application
        function initApp() {
            // Check for existing session
            if (sessionStorage.getItem('clinical_session')) {
                const session = JSON.parse(sessionStorage.getItem('clinical_session'));
                if (sessionManager.resumeSession()) {
                    showMainApp();
                } else {
                    showStartScreen();
                }
            } else {
                showStartScreen();
            }
            
            // Load programs data
            loadPrograms();
        }
        
        // Start new session
        function startNewSession() {
            const clinicianName = document.getElementById('clinician-name').value;
            sessionManager.createNewSession(clinicianName);
            showMainApp();
        }
        
        // Show/hide screens
        function showStartScreen() {
            document.getElementById('start-screen').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('session-header').style.display = 'none';
        }
        
        function showMainApp() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            document.getElementById('session-header').style.display = 'block';
            sessionManager.displaySessionHeader();
            loadPrograms();
        }
        
        // Tab switching
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Update tab panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            
            // Update comparison view if switching to compare tab
            if (tabName === 'compare') {
                comparisonMatrix.updateComparisonView();
            }
        }
        
        // Load programs
        function loadPrograms() {
            // This would load from your programs database
            // For now, using sample data
            const programs = window.programsData || getSamplePrograms();
            filteredPrograms = programs;
            displayPrograms(programs);
        }
        
        // Display programs
        function displayPrograms(programs) {
            const grid = document.getElementById('programs-grid');
            grid.innerHTML = '';
            
            programs.forEach(program => {
                const card = createProgramCard(program);
                grid.appendChild(card);
            });
            
            // Update count
            document.getElementById('programs-count').textContent = programs.length;
        }
        
        // Create program card
        function createProgramCard(program) {
            const card = document.createElement('div');
            card.className = 'program-card';
            card.dataset.programId = program.id;
            
            card.innerHTML = `
                <div class="program-header">
                    <div>
                        <h3 class="program-name">${program.name}</h3>
                        <div class="program-location">${program.location?.city || ''}, ${program.location?.state || ''}</div>
                    </div>
                    <div class="program-actions">
                        <button class="btn-program-action btn-compare" onclick="toggleCompare('${program.id}')">
                            Compare
                        </button>
                        <button class="btn-program-action" onclick="viewProgram('${program.id}')">
                            View
                        </button>
                    </div>
                </div>
                <div class="program-details">
                    <div class="detail-row">
                        <span class="detail-label">Levels of Care:</span>
                        <span class="detail-value">${(program.clinical?.levelsOfCare || []).join(', ')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Population:</span>
                        <span class="detail-value">${program.population?.ages || 'All'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Specialties:</span>
                        <span class="detail-value">${(program.clinical?.specializations || []).slice(0, 3).join(', ')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Insurance:</span>
                        <span class="detail-value">${(program.admissions?.insurance || []).slice(0, 3).join(', ')}</span>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Toggle program comparison
        function toggleCompare(programId) {
            const button = document.querySelector(`[data-program-id="${programId}"] .btn-compare`);
            
            if (button.classList.contains('active')) {
                comparisonMatrix.removeProgram(programId);
                button.classList.remove('active');
            } else {
                if (comparisonMatrix.addProgram(programId)) {
                    button.classList.add('active');
                }
            }
            
            // Update compare count
            document.getElementById('compare-count').textContent = comparisonMatrix.selectedPrograms.length;
        }
        
        // View program details
        function viewProgram(programId) {
            // Track view in session
            sessionManager.addProgramViewed(programId);
            
            // Open program details (implement as needed)
            console.log('Viewing program:', programId);
        }
        
        // Apply filters
        function applyFilters() {
            // Get selected filters
            const filters = {
                levelOfCare: [],
                population: [],
                specialization: [],
                insurance: []
            };
            
            // Collect checked filters
            document.querySelectorAll('.filter-checkbox input:checked').forEach(checkbox => {
                const value = checkbox.value;
                const group = checkbox.closest('.filter-group').querySelector('.filter-group-title').textContent;
                
                // Map to filter categories
                if (group.includes('Level')) filters.levelOfCare.push(value);
                if (group.includes('Population')) filters.population.push(value);
                if (group.includes('Specialization')) filters.specialization.push(value);
                if (group.includes('Insurance')) filters.insurance.push(value);
            });
            
            // Filter programs
            const programs = window.programsData || getSamplePrograms();
            filteredPrograms = programs.filter(program => {
                // Apply filter logic
                return true; // Implement actual filtering
            });
            
            displayPrograms(filteredPrograms);
        }
        
        // Search programs
        function searchPrograms() {
            const searchTerm = document.getElementById('program-search').value.toLowerCase();
            
            if (!searchTerm) {
                displayPrograms(filteredPrograms);
                return;
            }
            
            const results = filteredPrograms.filter(program => {
                return program.name.toLowerCase().includes(searchTerm) ||
                       (program.location?.city || '').toLowerCase().includes(searchTerm) ||
                       (program.location?.state || '').toLowerCase().includes(searchTerm);
            });
            
            displayPrograms(results);
        }
        
        // Clear search
        function clearSearch() {
            document.getElementById('program-search').value = '';
            displayPrograms(filteredPrograms);
        }
        
        // Document functions
        function showDocumentWizard(documentType) {
            // Implement document wizard
            console.log('Creating document:', documentType);
        }
        
        function closeDocumentPreview() {
            document.getElementById('document-preview-modal').style.display = 'none';
        }
        
        function exportDocument(format) {
            // Implement export
            console.log('Exporting as:', format);
        }
        
        // Sample programs data (replace with actual data)
        function getSamplePrograms() {
            return [
                {
                    id: 'prog_001',
                    name: 'Serenity Springs Recovery',
                    location: { city: 'Austin', state: 'TX' },
                    clinical: {
                        levelsOfCare: ['Residential', 'PHP', 'IOP'],
                        primaryFocus: 'Substance Use Disorders',
                        specializations: ['Dual Diagnosis', 'Trauma', 'Young Adults']
                    },
                    population: { ages: '18-30' },
                    admissions: { insurance: ['BCBS', 'Aetna', 'Cigna'] }
                },
                // Add more sample programs
            ];
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

<script>
/* Embedded Clinical Suite JavaScript */

// Session Manager
// session-manager.js - HIPAA-compliant session management for clinical workflow
// No PHI is persisted - all data clears when session ends

class SessionManager {
    constructor() {
        this.currentSession = null;
        this.sessionTimer = null;
        this.WARNING_TIME = 25 * 60 * 1000; // 25 minutes
        this.TIMEOUT_TIME = 30 * 60 * 1000; // 30 minutes
        this.initializeSession();
    }
    
    initializeSession() {
        // Check for existing session - using localStorage for consistency
        const existingSession = localStorage.getItem('clinical_session');
        if (existingSession) {
            this.currentSession = JSON.parse(existingSession);
            this.resumeSession();
        }
    }
    
    createNewSession(clinicianName = '') {
        const sessionId = this.generateSessionId();
        
        this.currentSession = {
            sessionId: sessionId,
            date: new Date().toISOString(),
            clinician: clinicianName,
            startTime: Date.now(),
            criteria: {
                age: '',
                ageGroup: '',
                primaryConcern: '',
                secondaryConcerns: [],
                levelOfCare: '',
                insurance: '',
                geographic: '',
                specialNeeds: []
            },
            programsViewed: [],
            programsCompared: [],
            programsSelected: [],
            documents: [],
            notes: '',
            lastActivity: Date.now()
        };
        
        this.saveSession();
        this.startSessionTimer();
        this.displaySessionHeader();
        
        return this.currentSession;
    }
    
    generateSessionId() {
        // Generate HIPAA-compliant ID (no PHI)
        const prefix = 'CC';
        const year = new Date().getFullYear();
        const randomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
        const timestamp = Date.now().toString(36).substring(-4).toUpperCase();
        
        return `${prefix}-${year}-${randomCode}${timestamp}`;
    }
    
    updateCriteria(criteria) {
        if (!this.currentSession) return;
        
        this.currentSession.criteria = {
            ...this.currentSession.criteria,
            ...criteria
        };
        
        this.currentSession.lastActivity = Date.now();
        this.saveSession();
    }
    
    addProgramViewed(programId) {
        if (!this.currentSession) return;
        
        if (!this.currentSession.programsViewed.includes(programId)) {
            this.currentSession.programsViewed.push(programId);
            this.currentSession.lastActivity = Date.now();
            this.saveSession();
        }
    }
    
    addProgramToCompare(programId) {
        if (!this.currentSession) return;
        
        if (!this.currentSession.programsCompared.includes(programId)) {
            this.currentSession.programsCompared.push(programId);
            this.currentSession.lastActivity = Date.now();
            this.saveSession();
        }
    }
    
    selectProgram(programId) {
        if (!this.currentSession) return;
        
        if (!this.currentSession.programsSelected.includes(programId)) {
            this.currentSession.programsSelected.push(programId);
            this.currentSession.lastActivity = Date.now();
            this.saveSession();
        }
    }
    
    addDocument(documentInfo) {
        if (!this.currentSession) return;
        
        this.currentSession.documents.push({
            type: documentInfo.type,
            timestamp: Date.now(),
            programs: documentInfo.programs || []
        });
        
        this.currentSession.lastActivity = Date.now();
        this.saveSession();
    }
    
    saveSession() {
        if (this.currentSession) {
            // Using localStorage for consistency across the app
            localStorage.setItem('clinical_session', JSON.stringify(this.currentSession));
        }
    }
    
    startSessionTimer() {
        // Clear any existing timer
        this.clearSessionTimer();
        
        // Warning at 25 minutes
        setTimeout(() => {
            this.showSessionWarning();
        }, this.WARNING_TIME);
        
        // Auto-end session at 30 minutes
        this.sessionTimer = setTimeout(() => {
            this.endSession(true);
        }, this.TIMEOUT_TIME);
    }
    
    clearSessionTimer() {
        if (this.sessionTimer) {
            clearTimeout(this.sessionTimer);
            this.sessionTimer = null;
        }
    }
    
    showSessionWarning() {
        const modal = document.createElement('div');
        modal.className = 'session-warning-modal';
        modal.innerHTML = `
            <div class="session-warning-content">
                <h3>‚ö†Ô∏è Session Timeout Warning</h3>
                <p>Your session will expire in 5 minutes.</p>
                <p>Please save any documents you need before the session ends.</p>
                <div class="session-warning-actions">
                    <button onclick="sessionManager.extendSession()" class="btn btn-primary">
                        Extend Session (30 min)
                    </button>
                    <button onclick="sessionManager.endSession()" class="btn btn-secondary">
                        End Session Now
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Auto-remove warning after 30 seconds
        setTimeout(() => {
            modal.remove();
        }, 30000);
    }
    
    extendSession() {
        this.currentSession.lastActivity = Date.now();
        this.saveSession();
        this.startSessionTimer();
        
        // Remove warning modal if present
        const modal = document.querySelector('.session-warning-modal');
        if (modal) modal.remove();
        
        this.showNotification('Session extended for 30 minutes', 'success');
    }
    
    resumeSession() {
        // Check if session is still valid (less than 30 min old)
        const sessionAge = Date.now() - this.currentSession.lastActivity;
        
        if (sessionAge > this.TIMEOUT_TIME) {
            this.endSession(true);
            return false;
        }
        
        // Resume timer with remaining time
        const remainingTime = this.TIMEOUT_TIME - sessionAge;
        this.sessionTimer = setTimeout(() => {
            this.endSession(true);
        }, remainingTime);
        
        this.displaySessionHeader();
        return true;
    }
    
    endSession(timeout = false) {
        if (this.currentSession) {
            // Generate session summary
            const summary = this.generateSessionSummary();
            
            if (!timeout && summary.hasUnsavedWork) {
                if (!confirm('You have unsaved work. Are you sure you want to end this session?')) {
                    return;
                }
            }
            
            // Clear all session data
            sessionStorage.removeItem('clinical_session');
            this.currentSession = null;
            this.clearSessionTimer();
            
            // Clear any temporary UI elements
            this.clearSessionUI();
            
            // Show completion message
            if (timeout) {
                this.showNotification('Session expired. All temporary data has been cleared.', 'warning');
            } else {
                this.showNotification('Session ended. All temporary data has been cleared.', 'info');
            }
            
            // Redirect to start page
            setTimeout(() => {
                location.reload();
            }, 2000);
        }
    }
    
    generateSessionSummary() {
        if (!this.currentSession) return null;
        
        const duration = Date.now() - this.currentSession.startTime;
        const minutes = Math.floor(duration / 60000);
        
        return {
            sessionId: this.currentSession.sessionId,
            duration: `${minutes} minutes`,
            programsViewed: this.currentSession.programsViewed.length,
            programsCompared: this.currentSession.programsCompared.length,
            programsSelected: this.currentSession.programsSelected.length,
            documentsGenerated: this.currentSession.documents.length,
            hasUnsavedWork: this.currentSession.documents.length > 0 && 
                           this.currentSession.documents.some(d => !d.exported)
        };
    }
    
    displaySessionHeader() {
        if (!this.currentSession) return;
        
        const header = document.getElementById('session-header');
        if (header) {
            const elapsed = Math.floor((Date.now() - this.currentSession.startTime) / 60000);
            
            header.innerHTML = `
                <div class="session-info">
                    <span class="session-id">Session: ${this.currentSession.sessionId}</span>
                    <span class="session-clinician">${this.currentSession.clinician || 'Clinician'}</span>
                    <span class="session-timer">${elapsed} min</span>
                    <button class="btn-end-session" onclick="sessionManager.endSession()">
                        End Session
                    </button>
                </div>
                <div class="session-warning">
                    ‚ö†Ô∏è Session data is temporary and will be cleared when you close this tab
                </div>
            `;
        }
    }
    
    clearSessionUI() {
        // Clear all temporary UI elements
        const sessionElements = document.querySelectorAll('[data-session-temp]');
        sessionElements.forEach(el => {
            el.value = '';
            el.textContent = '';
        });
        
        // Clear comparison selections
        const compareCheckboxes = document.querySelectorAll('.compare-checkbox');
        compareCheckboxes.forEach(cb => cb.checked = false);
        
        // Hide session-dependent sections
        const sessionSections = document.querySelectorAll('.session-only');
        sessionSections.forEach(section => section.style.display = 'none');
    }
    
    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('fade-out');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    exportSessionData() {
        if (!this.currentSession) return null;
        
        // Create a safe export without any PHI
        const exportData = {
            sessionId: this.currentSession.sessionId,
            date: this.currentSession.date,
            programsReviewed: this.currentSession.programsViewed,
            programsCompared: this.currentSession.programsCompared,
            selectedPrograms: this.currentSession.programsSelected,
            criteria: {
                levelOfCare: this.currentSession.criteria.levelOfCare,
                ageGroup: this.currentSession.criteria.ageGroup,
                primaryConcern: this.currentSession.criteria.primaryConcern
            }
        };
        
        return exportData;
    }
}

// Initialize session manager globally
window.sessionManager = new SessionManager();


// Comparison Matrix
// comparison-matrix.js - Advanced program comparison tool for clinical decision-making

class ComparisonMatrix {
    constructor() {
        this.selectedPrograms = [];
        this.maxPrograms = 4;
        this.comparisonCategories = {
            'Clinical Services': [
                'levelsOfCare',
                'primaryFocus',
                'specializations',
                'evidenceBasedTherapies',
                'experientialTherapies',
                'holisticTherapies'
            ],
            'Population': [
                'agesServed',
                'gender',
                'specialPopulations'
            ],
            'Program Structure': [
                'programLength',
                'capacity',
                'staffRatio',
                'groupSize'
            ],
            'Medical & Psychiatric': [
                'medicalServices',
                'psychiatricServices',
                'medicationManagement',
                'detoxServices'
            ],
            'Family Program': [
                'familyTherapy',
                'familyEducation',
                'familyVisitation'
            ],
            'Academic/Vocational': [
                'academicSupport',
                'vocationalTraining',
                'collegePrep'
            ],
            'Admissions & Insurance': [
                'insuranceAccepted',
                'privatePayOptions',
                'financialAssistance',
                'admissionRequirements'
            ],
            'Accreditations & Quality': [
                'accreditations',
                'memberships',
                'successMetrics'
            ],
            'Amenities & Environment': [
                'setting',
                'facilities',
                'roomTypes',
                'recreation'
            ],
            'Aftercare & Support': [
                'aftercareServices',
                'alumniProgram',
                'transitionSupport'
            ]
        };
    }
    
    addProgram(programId) {
        if (this.selectedPrograms.length >= this.maxPrograms) {
            this.showNotification(`Maximum ${this.maxPrograms} programs can be compared at once`, 'warning');
            return false;
        }
        
        if (!this.selectedPrograms.includes(programId)) {
            this.selectedPrograms.push(programId);
            this.updateComparisonView();
            
            // Track in session
            if (window.sessionManager) {
                window.sessionManager.addProgramToCompare(programId);
            }
            
            return true;
        }
        
        return false;
    }
    
    removeProgram(programId) {
        const index = this.selectedPrograms.indexOf(programId);
        if (index > -1) {
            this.selectedPrograms.splice(index, 1);
            this.updateComparisonView();
        }
    }
    
    clearComparison() {
        this.selectedPrograms = [];
        this.updateComparisonView();
    }
    
    generateComparisonMatrix() {
        if (this.selectedPrograms.length < 2) {
            return null;
        }
        
        const programs = this.selectedPrograms.map(id => this.getProgramData(id));
        const matrix = document.createElement('div');
        matrix.className = 'comparison-matrix';
        
        // Header with program names
        const header = this.createMatrixHeader(programs);
        matrix.appendChild(header);
        
        // Category sections
        Object.entries(this.comparisonCategories).forEach(([category, fields]) => {
            const section = this.createCategorySection(category, fields, programs);
            matrix.appendChild(section);
        });
        
        // Action buttons
        const actions = this.createMatrixActions();
        matrix.appendChild(actions);
        
        return matrix;
    }
    
    createMatrixHeader(programs) {
        const header = document.createElement('div');
        header.className = 'matrix-header';
        
        header.innerHTML = `
            <div class="matrix-row header-row">
                <div class="matrix-cell category-header">
                    <h3>Comparison Criteria</h3>
                </div>
                ${programs.map(program => `
                    <div class="matrix-cell program-header">
                        <h4>${program.name}</h4>
                        <p class="program-location">${program.location.city}, ${program.location.state}</p>
                        <button class="btn-remove-program" data-program-id="${program.id}">
                            Remove
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
        
        // Add remove handlers
        header.querySelectorAll('.btn-remove-program').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.removeProgram(e.target.dataset.programId);
            });
        });
        
        return header;
    }
    
    createCategorySection(categoryName, fields, programs) {
        const section = document.createElement('div');
        section.className = 'matrix-category';
        
        // Category title
        const title = document.createElement('div');
        title.className = 'matrix-category-title';
        title.innerHTML = `<h4>${categoryName}</h4>`;
        section.appendChild(title);
        
        // Field rows
        fields.forEach(field => {
            const row = this.createFieldRow(field, programs);
            section.appendChild(row);
        });
        
        return section;
    }
    
    createFieldRow(fieldName, programs) {
        const row = document.createElement('div');
        row.className = 'matrix-row';
        
        // Field label
        const labelCell = document.createElement('div');
        labelCell.className = 'matrix-cell field-label';
        labelCell.textContent = this.formatFieldName(fieldName);
        row.appendChild(labelCell);
        
        // Program values
        programs.forEach(program => {
            const valueCell = document.createElement('div');
            valueCell.className = 'matrix-cell field-value';
            
            const value = this.getFieldValue(program, fieldName);
            const formattedValue = this.formatFieldValue(fieldName, value);
            
            // Highlight differences
            if (this.isDifferent(fieldName, programs)) {
                valueCell.classList.add('different');
            }
            
            // Special formatting for certain fields
            if (fieldName === 'insuranceAccepted' && Array.isArray(value)) {
                valueCell.innerHTML = this.formatInsuranceList(value);
            } else if (Array.isArray(value)) {
                valueCell.innerHTML = this.formatArrayValue(value);
            } else if (typeof value === 'boolean') {
                valueCell.innerHTML = this.formatBooleanValue(value);
            } else {
                valueCell.textContent = formattedValue || 'Not specified';
            }
            
            row.appendChild(valueCell);
        });
        
        return row;
    }
    
    getFieldValue(program, fieldName) {
        // Navigate nested object structure
        const fieldMap = {
            'levelsOfCare': program.clinical?.levelsOfCare,
            'primaryFocus': program.clinical?.primaryFocus,
            'specializations': program.clinical?.specializations,
            'evidenceBasedTherapies': program.clinical?.modalities?.evidenceBased,
            'experientialTherapies': program.clinical?.modalities?.experiential,
            'holisticTherapies': program.clinical?.modalities?.holistic,
            'agesServed': program.population?.ages,
            'gender': program.population?.gender,
            'specialPopulations': program.population?.specialPopulations,
            'programLength': program.structure?.lengthOfStay,
            'capacity': program.structure?.capacity,
            'staffRatio': program.structure?.staffRatio,
            'groupSize': program.structure?.groupSize,
            'medicalServices': program.medical?.services,
            'psychiatricServices': program.medical?.psychiatric,
            'medicationManagement': program.medical?.medicationManagement,
            'detoxServices': program.medical?.detox,
            'familyTherapy': program.family?.therapy,
            'familyEducation': program.family?.education,
            'familyVisitation': program.family?.visitation,
            'academicSupport': program.education?.academic,
            'vocationalTraining': program.education?.vocational,
            'collegePrep': program.education?.collegePrep,
            'insuranceAccepted': program.admissions?.insurance,
            'privatePayOptions': program.admissions?.privatePay,
            'financialAssistance': program.admissions?.financialAid,
            'admissionRequirements': program.admissions?.requirements,
            'accreditations': program.quality?.accreditations,
            'memberships': program.quality?.memberships,
            'successMetrics': program.quality?.outcomes,
            'setting': program.environment?.setting,
            'facilities': program.environment?.facilities,
            'roomTypes': program.environment?.roomTypes,
            'recreation': program.environment?.recreation,
            'aftercareServices': program.aftercare?.services,
            'alumniProgram': program.aftercare?.alumni,
            'transitionSupport': program.aftercare?.transition
        };
        
        return fieldMap[fieldName];
    }
    
    formatFieldName(fieldName) {
        // Convert camelCase to readable text
        return fieldName
            .replace(/([A-Z])/g, ' $1')
            .replace(/^./, str => str.toUpperCase())
            .trim();
    }
    
    formatFieldValue(fieldName, value) {
        if (value === null || value === undefined) {
            return 'Not specified';
        }
        
        if (Array.isArray(value)) {
            return value.length > 0 ? value.join(', ') : 'None specified';
        }
        
        if (typeof value === 'boolean') {
            return value ? 'Yes' : 'No';
        }
        
        return value.toString();
    }
    
    formatInsuranceList(insuranceArray) {
        if (!insuranceArray || insuranceArray.length === 0) {
            return '<span class="no-insurance">No insurance information</span>';
        }
        
        const majorInsurers = ['BCBS', 'Aetna', 'Cigna', 'United', 'Anthem', 'Humana'];
        const hasMajor = insuranceArray.some(ins => 
            majorInsurers.some(major => ins.includes(major))
        );
        
        return `
            <div class="insurance-list">
                ${hasMajor ? '<span class="has-major">‚úì Major insurers</span>' : ''}
                <ul>
                    ${insuranceArray.map(ins => `<li>${ins}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    formatArrayValue(array) {
        if (!array || array.length === 0) {
            return '<span class="empty-value">None specified</span>';
        }
        
        if (array.length > 3) {
            return `
                <div class="array-value">
                    <span class="count">${array.length} items</span>
                    <ul class="compact-list">
                        ${array.slice(0, 3).map(item => `<li>${item}</li>`).join('')}
                        <li class="more">...and ${array.length - 3} more</li>
                    </ul>
                </div>
            `;
        }
        
        return `
            <ul class="compact-list">
                ${array.map(item => `<li>${item}</li>`).join('')}
            </ul>
        `;
    }
    
    formatBooleanValue(value) {
        if (value) {
            return '<span class="boolean-yes">‚úì Yes</span>';
        }
        return '<span class="boolean-no">‚úó No</span>';
    }
    
    isDifferent(fieldName, programs) {
        const values = programs.map(p => this.getFieldValue(p, fieldName));
        
        // Handle array comparison
        if (Array.isArray(values[0])) {
            return !values.every(v => 
                JSON.stringify(v?.sort()) === JSON.stringify(values[0]?.sort())
            );
        }
        
        // Simple value comparison
        return !values.every(v => v === values[0]);
    }
    
    createMatrixActions() {
        const actions = document.createElement('div');
        actions.className = 'matrix-actions';
        
        actions.innerHTML = `
            <button class="btn btn-primary" onclick="comparisonMatrix.exportComparison()">
                Export Comparison (PDF)
            </button>
            <button class="btn btn-secondary" onclick="comparisonMatrix.printComparison()">
                Print Comparison
            </button>
            <button class="btn btn-secondary" onclick="comparisonMatrix.saveAsTemplate()">
                Save as Template
            </button>
            <button class="btn btn-tertiary" onclick="comparisonMatrix.clearComparison()">
                Clear Comparison
            </button>
        `;
        
        return actions;
    }
    
    exportComparison() {
        // Generate PDF export
        const matrix = this.generateComparisonMatrix();
        if (!matrix) {
            this.showNotification('Please select at least 2 programs to compare', 'warning');
            return;
        }
        
        // Create print-friendly version
        const printContent = this.createPrintVersion(matrix);
        
        // Generate PDF using browser print
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Program Comparison - ${new Date().toLocaleDateString()}</title>
                <style>
                    ${this.getPrintStyles()}
                </style>
            </head>
            <body>
                ${printContent}
            </body>
            </html>
        `);
        
        printWindow.document.close();
        printWindow.print();
    }
    
    printComparison() {
        window.print();
    }
    
    saveAsTemplate() {
        // Save current comparison criteria as a template
        const template = {
            name: prompt('Enter template name:'),
            date: new Date().toISOString(),
            programs: this.selectedPrograms,
            criteria: Object.keys(this.comparisonCategories)
        };
        
        if (template.name) {
            const templates = JSON.parse(localStorage.getItem('comparisonTemplates') || '[]');
            templates.push(template);
            localStorage.setItem('comparisonTemplates', JSON.stringify(templates));
            
            this.showNotification('Template saved successfully', 'success');
        }
    }
    
    getProgramData(programId) {
        // Get program data from the main programs array
        // This would connect to your existing program database
        return window.programsData?.find(p => p.id === programId) || {};
    }
    
    updateComparisonView() {
        const container = document.getElementById('comparison-container');
        if (!container) return;
        
        if (this.selectedPrograms.length === 0) {
            container.innerHTML = `
                <div class="comparison-empty">
                    <p>Select 2-4 programs to compare</p>
                </div>
            `;
        } else if (this.selectedPrograms.length === 1) {
            container.innerHTML = `
                <div class="comparison-waiting">
                    <p>1 program selected. Select at least 1 more to compare.</p>
                </div>
            `;
        } else {
            const matrix = this.generateComparisonMatrix();
            container.innerHTML = '';
            container.appendChild(matrix);
        }
    }
    
    getPrintStyles() {
        return `
            body { font-family: Arial, sans-serif; }
            .matrix-header { background: #f0f0f0; font-weight: bold; }
            .matrix-row { display: flex; border-bottom: 1px solid #ddd; }
            .matrix-cell { flex: 1; padding: 8px; }
            .matrix-category-title { background: #e0e0e0; padding: 5px; margin-top: 10px; }
            .different { background: #fff3cd; }
            @media print {
                .btn { display: none; }
                .matrix-actions { display: none; }
            }
        `;
    }
    
    createPrintVersion(matrix) {
        const clone = matrix.cloneNode(true);
        // Remove buttons and interactive elements
        clone.querySelectorAll('button').forEach(btn => btn.remove());
        return clone.outerHTML;
    }
    
    showNotification(message, type) {
        // Use session manager's notification if available
        if (window.sessionManager) {
            window.sessionManager.showNotification(message, type);
        } else {
            alert(message);
        }
    }
}

// Initialize comparison matrix globally
window.comparisonMatrix = new ComparisonMatrix();


// Document Generator
// document-generator.js - Professional document generation for aftercare planning

class DocumentGenerator {
    constructor() {
        this.templates = {
            aftercareOptions: this.getAftercareOptionsTemplate(),
            aftercarePlan: this.getAftercarePlanTemplate(),
            dischargePacket: this.getDischargePacketTemplate()
        };
        
        this.documentQueue = [];
    }
    
    // ============= AFTERCARE OPTIONS DOCUMENT =============
    
    generateAftercareOptions(programs, sessionData = null) {
        if (!programs || programs.length === 0) {
            throw new Error('No programs selected for aftercare options document');
        }
        
        const document = {
            type: 'aftercareOptions',
            timestamp: new Date().toISOString(),
            sessionId: sessionData?.sessionId || 'DIRECT',
            content: this.buildAftercareOptionsContent(programs, sessionData)
        };
        
        // Track in session if available
        if (window.sessionManager) {
            window.sessionManager.addDocument({
                type: 'aftercareOptions',
                programs: programs.map(p => p.id)
            });
        }
        
        return document;
    }
    
    buildAftercareOptionsContent(programs, sessionData) {
        const date = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        let content = `
            <div class="document aftercare-options">
                <div class="document-header">
                    <h1>Aftercare Treatment Options</h1>
                    <div class="document-meta">
                        <p>Date: ${date}</p>
                        ${sessionData?.sessionId ? `<p>Session ID: ${sessionData.sessionId}</p>` : ''}
                        ${sessionData?.clinician ? `<p>Prepared by: ${sessionData.clinician}</p>` : ''}
                    </div>
                </div>
                
                <div class="document-intro">
                    <p>The following treatment programs have been identified as potential aftercare options based on the clinical assessment and treatment needs discussed.</p>
                </div>
                
                <div class="programs-section">
        `;
        
        programs.forEach((program, index) => {
            content += this.generateProgramSection(program, index + 1);
        });
        
        content += `
                </div>
                
                <div class="document-footer">
                    <h3>Next Steps</h3>
                    <ol>
                        <li>Review each program option carefully</li>
                        <li>Contact admissions departments for availability and specific questions</li>
                        <li>Verify insurance coverage and financial arrangements</li>
                        <li>Schedule tours or virtual visits when possible</li>
                        <li>Discuss options with your treatment team and family</li>
                    </ol>
                    
                    <div class="disclaimer">
                        <p><strong>Important Note:</strong> This document provides general information about treatment programs. 
                        Admission decisions are made by individual programs based on their assessment of clinical appropriateness 
                        and availability. Insurance coverage should be verified directly with your insurance provider and the 
                        treatment program.</p>
                    </div>
                </div>
            </div>
        `;
        
        return content;
    }
    
    generateProgramSection(program, number) {
        return `
            <div class="program-option">
                <h2>Option ${number}: ${program.name}</h2>
                
                <div class="program-overview">
                    <div class="program-location">
                        <strong>Location:</strong> ${program.location?.city || ''}, ${program.location?.state || ''}
                        ${program.location?.distance ? `(${program.location.distance} miles)` : ''}
                    </div>
                    
                    <div class="program-contact">
                        <strong>Contact:</strong>
                        ${program.contact?.phone ? `Phone: ${program.contact.phone}` : ''}
                        ${program.contact?.email ? `| Email: ${program.contact.email}` : ''}
                        ${program.website ? `<br>Website: ${program.website}` : ''}
                    </div>
                </div>
                
                <div class="clinical-services">
                    <h3>Clinical Services</h3>
                    
                    <div class="levels-of-care">
                        <strong>Levels of Care:</strong>
                        <ul>
                            ${(program.clinical?.levelsOfCare || []).map(level => 
                                `<li>${level}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    
                    ${program.clinical?.primaryFocus ? `
                        <div class="primary-focus">
                            <strong>Primary Focus:</strong> ${program.clinical.primaryFocus}
                        </div>
                    ` : ''}
                    
                    ${program.clinical?.specializations?.length > 0 ? `
                        <div class="specializations">
                            <strong>Specializations:</strong>
                            ${program.clinical.specializations.join(', ')}
                        </div>
                    ` : ''}
                    
                    <div class="therapeutic-modalities">
                        <strong>Therapeutic Approaches:</strong>
                        <ul>
                            ${(program.clinical?.modalities?.evidenceBased || []).map(therapy => 
                                `<li>${therapy} (Evidence-Based)</li>`
                            ).join('')}
                            ${(program.clinical?.modalities?.experiential || []).map(therapy => 
                                `<li>${therapy} (Experiential)</li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="program-details">
                    <h3>Program Details</h3>
                    
                    <div class="population">
                        <strong>Population Served:</strong>
                        ${program.population?.ages || 'All ages'}
                        ${program.population?.gender ? `| ${program.population.gender}` : ''}
                    </div>
                    
                    ${program.structure?.lengthOfStay ? `
                        <div class="length-of-stay">
                            <strong>Typical Length of Stay:</strong> ${program.structure.lengthOfStay}
                        </div>
                    ` : ''}
                    
                    ${program.family?.involvement ? `
                        <div class="family-program">
                            <strong>Family Involvement:</strong> ${program.family.involvement}
                        </div>
                    ` : ''}
                </div>
                
                <div class="admissions-insurance">
                    <h3>Admissions & Insurance</h3>
                    
                    ${program.admissions?.insurance?.length > 0 ? `
                        <div class="insurance">
                            <strong>Insurance Accepted:</strong>
                            ${program.admissions.insurance.join(', ')}
                        </div>
                    ` : ''}
                    
                    ${program.admissions?.requirements?.length > 0 ? `
                        <div class="requirements">
                            <strong>Admission Requirements:</strong>
                            <ul>
                                ${program.admissions.requirements.map(req => 
                                    `<li>${req}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
                
                ${program.quality?.accreditations?.length > 0 ? `
                    <div class="accreditations">
                        <strong>Accreditations:</strong> ${program.quality.accreditations.join(', ')}
                    </div>
                ` : ''}
                
                ${program.notes ? `
                    <div class="clinical-notes">
                        <strong>Clinical Notes:</strong> ${program.notes}
                    </div>
                ` : ''}
            </div>
        `;
    }
    
    // ============= AFTERCARE PLAN DOCUMENT =============
    
    generateAftercarePlan(selectedProgram, transitionPlan, sessionData = null) {
        if (!selectedProgram) {
            throw new Error('No program selected for aftercare plan');
        }
        
        const document = {
            type: 'aftercarePlan',
            timestamp: new Date().toISOString(),
            sessionId: sessionData?.sessionId || 'DIRECT',
            content: this.buildAftercarePlanContent(selectedProgram, transitionPlan, sessionData)
        };
        
        // Track in session
        if (window.sessionManager) {
            window.sessionManager.addDocument({
                type: 'aftercarePlan',
                programs: [selectedProgram.id]
            });
        }
        
        return document;
    }
    
    buildAftercarePlanContent(program, plan, sessionData) {
        const date = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        return `
            <div class="document aftercare-plan">
                <div class="document-header">
                    <h1>Aftercare Treatment Plan</h1>
                    <div class="document-meta">
                        <p>Date: ${date}</p>
                        ${sessionData?.sessionId ? `<p>Session ID: ${sessionData.sessionId}</p>` : ''}
                        ${sessionData?.clinician ? `<p>Prepared by: ${sessionData.clinician}</p>` : ''}
                    </div>
                </div>
                
                <div class="selected-program">
                    <h2>Recommended Program</h2>
                    <div class="program-info">
                        <h3>${program.name}</h3>
                        <p>${program.location?.city}, ${program.location?.state}</p>
                        <p>Contact: ${program.contact?.phone || ''}</p>
                    </div>
                </div>
                
                <div class="transition-timeline">
                    <h2>Transition Timeline</h2>
                    <table class="timeline-table">
                        <tr>
                            <th>Phase</th>
                            <th>Timeline</th>
                            <th>Actions</th>
                        </tr>
                        <tr>
                            <td>Pre-Admission</td>
                            <td>${plan?.preAdmissionDate || '[To be determined]'}</td>
                            <td>
                                <ul>
                                    <li>Complete admission paperwork</li>
                                    <li>Insurance verification</li>
                                    <li>Medical clearance if required</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Admission</td>
                            <td>${plan?.admissionDate || '[To be determined]'}</td>
                            <td>
                                <ul>
                                    <li>Intake assessment</li>
                                    <li>Orientation to program</li>
                                    <li>Initial treatment planning</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Active Treatment</td>
                            <td>${plan?.treatmentDuration || program.structure?.lengthOfStay || '[Variable]'}</td>
                            <td>
                                <ul>
                                    <li>Participate in all program components</li>
                                    <li>Regular family involvement</li>
                                    <li>Progress monitoring</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td>Discharge Planning</td>
                            <td>${plan?.dischargePlanning || '2-4 weeks before completion'}</td>
                            <td>
                                <ul>
                                    <li>Aftercare planning</li>
                                    <li>Coordinate continuing care</li>
                                    <li>Establish support systems</li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div class="treatment-goals">
                    <h2>Treatment Goals</h2>
                    <ol>
                        ${(plan?.goals || [
                            'Stabilization and safety',
                            'Development of coping skills',
                            'Address underlying issues',
                            'Family healing and education',
                            'Relapse prevention planning',
                            'Transition to lower level of care'
                        ]).map(goal => `<li>${goal}</li>`).join('')}
                    </ol>
                </div>
                
                <div class="clinical-recommendations">
                    <h2>Clinical Recommendations</h2>
                    <ul>
                        <li><strong>Level of Care:</strong> ${program.clinical?.levelsOfCare?.[0] || 'As determined by assessment'}</li>
                        <li><strong>Primary Focus:</strong> ${program.clinical?.primaryFocus || 'Comprehensive treatment'}</li>
                        <li><strong>Therapeutic Modalities:</strong> ${(program.clinical?.modalities?.evidenceBased || []).join(', ') || 'Multi-modal approach'}</li>
                        <li><strong>Family Involvement:</strong> ${program.family?.involvement || 'Encouraged'}</li>
                    </ul>
                </div>
                
                <div class="follow-up">
                    <h2>Follow-Up Care</h2>
                    <p>Upon completion of the program, the following continuing care is recommended:</p>
                    <ul>
                        <li>Outpatient therapy (individual and/or group)</li>
                        <li>Psychiatric services as needed</li>
                        <li>Support group participation</li>
                        <li>Family therapy continuation</li>
                        <li>Academic/vocational support</li>
                        <li>Alumni program participation</li>
                    </ul>
                </div>
                
                <div class="signatures">
                    <h2>Acknowledgment</h2>
                    <p>This aftercare plan has been reviewed and discussed with all relevant parties.</p>
                    <div class="signature-lines">
                        <div class="signature-line">
                            <p>_______________________________</p>
                            <p>Patient/Guardian Signature</p>
                            <p>Date: _______________</p>
                        </div>
                        <div class="signature-line">
                            <p>_______________________________</p>
                            <p>Clinician Signature</p>
                            <p>Date: _______________</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // ============= DISCHARGE PACKET COMPILER =============
    
    compileDischargePacket(components, sessionData = null) {
        const packet = {
            type: 'dischargePacket',
            timestamp: new Date().toISOString(),
            sessionId: sessionData?.sessionId || 'DIRECT',
            components: components,
            content: this.buildDischargePacket(components, sessionData)
        };
        
        // Track in session
        if (window.sessionManager) {
            window.sessionManager.addDocument({
                type: 'dischargePacket',
                components: components.map(c => c.type)
            });
        }
        
        return packet;
    }
    
    buildDischargePacket(components, sessionData) {
        const date = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        let content = `
            <div class="document discharge-packet">
                <div class="cover-page">
                    <h1>Discharge Documentation Packet</h1>
                    <div class="packet-meta">
                        <p>Prepared: ${date}</p>
                        ${sessionData?.sessionId ? `<p>Session ID: ${sessionData.sessionId}</p>` : ''}
                        ${sessionData?.clinician ? `<p>Clinician: ${sessionData.clinician}</p>` : ''}
                    </div>
                    
                    <div class="table-of-contents">
                        <h2>Contents</h2>
                        <ol>
                            ${components.map(component => 
                                `<li>${this.getComponentTitle(component.type)}</li>`
                            ).join('')}
                        </ol>
                    </div>
                </div>
                
                <div class="page-break"></div>
        `;
        
        // Add each component
        components.forEach(component => {
            content += component.content;
            content += '<div class="page-break"></div>';
        });
        
        content += `
            </div>
        `;
        
        return content;
    }
    
    getComponentTitle(type) {
        const titles = {
            'aftercareOptions': 'Aftercare Treatment Options',
            'aftercarePlan': 'Aftercare Treatment Plan',
            'insuranceAuth': 'Insurance Authorization Request',
            'clinicalSummary': 'Clinical Summary',
            'familyEducation': 'Family Education Materials',
            'programBrochures': 'Program Information',
            'consentForms': 'Consent Forms',
            'medicationList': 'Current Medications',
            'emergencyContacts': 'Emergency Contact Information'
        };
        
        return titles[type] || type;
    }
    
    // ============= EXPORT FUNCTIONS =============
    
    exportAsPDF(document) {
        // Create a new window for printing
        const printWindow = window.open('', '_blank');
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>${document.type} - ${new Date().toLocaleDateString()}</title>
                <style>
                    ${this.getPrintStyles()}
                </style>
            </head>
            <body>
                ${document.content}
            </body>
            </html>
        `);
        
        printWindow.document.close();
        
        // Auto-print after load
        printWindow.onload = function() {
            printWindow.print();
        };
    }
    
    exportAsWord(document) {
        // Create a blob with Word-compatible HTML
        const html = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                  xmlns:w='urn:schemas-microsoft-com:office:word' 
                  xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>${document.type}</title>
                <style>
                    body { font-family: Arial, sans-serif; }
                    h1 { font-size: 24pt; }
                    h2 { font-size: 18pt; }
                    h3 { font-size: 14pt; }
                    .page-break { page-break-before: always; }
                </style>
            </head>
            <body>
                ${document.content}
            </body>
            </html>
        `;
        
        const blob = new Blob([html], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = `${document.type}_${new Date().getTime()}.doc`;
        link.click();
        
        URL.revokeObjectURL(url);
    }
    
    getPrintStyles() {
        return `
            @page {
                size: letter;
                margin: 1in;
            }
            
            body {
                font-family: 'Times New Roman', serif;
                font-size: 12pt;
                line-height: 1.5;
                color: #000;
            }
            
            h1 {
                font-size: 24pt;
                margin-bottom: 12pt;
                text-align: center;
            }
            
            h2 {
                font-size: 18pt;
                margin-top: 18pt;
                margin-bottom: 12pt;
                border-bottom: 2px solid #000;
            }
            
            h3 {
                font-size: 14pt;
                margin-top: 12pt;
                margin-bottom: 8pt;
                font-weight: bold;
            }
            
            .document-header {
                border-bottom: 3px solid #000;
                padding-bottom: 12pt;
                margin-bottom: 24pt;
            }
            
            .document-meta {
                text-align: right;
                font-size: 10pt;
            }
            
            .program-option {
                page-break-inside: avoid;
                margin-bottom: 24pt;
                border: 1px solid #ccc;
                padding: 12pt;
            }
            
            .page-break {
                page-break-before: always;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 12pt 0;
            }
            
            th, td {
                border: 1px solid #000;
                padding: 8pt;
                text-align: left;
            }
            
            th {
                background-color: #f0f0f0;
                font-weight: bold;
            }
            
            .signature-lines {
                display: flex;
                justify-content: space-between;
                margin-top: 48pt;
            }
            
            .signature-line {
                width: 45%;
                text-align: center;
            }
            
            @media print {
                .no-print {
                    display: none;
                }
            }
        `;
    }
    
    // ============= TEMPLATE MANAGEMENT =============
    
    getAftercareOptionsTemplate() {
        return {
            sections: [
                'header',
                'introduction',
                'programOptions',
                'nextSteps',
                'disclaimer'
            ],
            requiredFields: [
                'programs',
                'date'
            ]
        };
    }
    
    getAftercarePlanTemplate() {
        return {
            sections: [
                'header',
                'selectedProgram',
                'transitionTimeline',
                'treatmentGoals',
                'clinicalRecommendations',
                'followUpCare',
                'signatures'
            ],
            requiredFields: [
                'program',
                'date'
            ]
        };
    }
    
    getDischargePacketTemplate() {
        return {
            sections: [
                'coverPage',
                'tableOfContents',
                'components'
            ],
            requiredFields: [
                'components',
                'date'
            ]
        };
    }
}

// Initialize document generator globally
window.documentGenerator = new DocumentGenerator();


// Programs Data (will be populated from Chrome extension)
window.programsData = [];

// Initialize programs data from localStorage if available
try {
    const storedPrograms = localStorage.getItem('careconnect_programs');
    if (storedPrograms) {
        window.programsData = JSON.parse(storedPrograms);
        console.log('Loaded ' + window.programsData.length + ' programs from storage');
    }
} catch (e) {
    console.log('No stored programs found');
}
</script>

<!-- Session Management & Data Persistence Scripts -->
<script src="js/auth/login-robust.js"></script>
<script src="js/data-persistence.js"></script>

<script>
// Initialize session check on page load
(function() {
    'use strict';
    
    // Check if user is logged in
    const checkSession = () => {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const loginExpires = parseInt(localStorage.getItem('loginExpires') || '0', 10);
        const now = Date.now();
        
        if (!isLoggedIn || (loginExpires && now > loginExpires)) {
            console.log('üîê Session expired or not logged in, redirecting to login...');
            // Clear expired session
            if (loginExpires && now > loginExpires) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                localStorage.removeItem('fullName');
                localStorage.removeItem('userRole');
                localStorage.removeItem('loginExpires');
            }
            // Redirect to login page or show login screen
            if (window.location.pathname !== '/login.html') {
                window.location.href = 'login.html';
            }
        } else {
            console.log('‚úÖ Valid session found, user authenticated');
            // Refresh TTL on page load
            if (window.refreshLoginSessionTTL) {
                window.refreshLoginSessionTTL();
            }
        }
    };
    
    // Check session immediately
    checkSession();
    
    // Also check periodically (every minute)
    setInterval(checkSession, 60000);
    
    // Listen for storage changes (in case user logs out in another tab)
    window.addEventListener('storage', (e) => {
        if (e.key === 'isLoggedIn' && e.newValue !== 'true') {
            console.log('üîê User logged out in another tab, redirecting...');
            window.location.href = 'login.html';
        }
    });
    
    console.log('üîí Session management initialized');
})();
</script>

</body>
</html>
