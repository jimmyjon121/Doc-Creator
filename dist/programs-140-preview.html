<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>140 Programs Preview</title>
    <script>
        // Set up feature flags before anything else loads
        window.featureFlags = {
            programsV2Data: true,
            dashboardEnabled: false,
            clientsTabEnabled: false,
            trackerEnabled: false
        };
        console.log('Feature flags set:', window.featureFlags);
    </script>
    <style>
        body { margin: 0; padding: 0; }
        .status-bar {
            background: #2563eb;
            color: white;
            padding: 10px 20px;
            font-family: system-ui, sans-serif;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .status-bar button {
            background: white;
            color: #2563eb;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .status-bar button:hover {
            background: #f0f0f0;
        }
        #moduleContainer {
            height: calc(100vh - 50px);
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <strong>140 Programs Dataset Preview</strong>
        <span>Feature flag: programsV2Data = true</span>
        <button onclick="checkDataStatus()">Check Data Status</button>
        <span id="dataStatus"></span>
    </div>
    
    <div id="moduleContainer"></div>
    
    <script>
        // Load the module content directly into the page
        fetch('programs-docs-module.html')
            .then(response => response.text())
            .then(html => {
                // Extract the body content
                const bodyMatch = html.match(/<body[^>]*>([\s\S]*)<\/body>/i);
                if (bodyMatch) {
                    document.getElementById('moduleContainer').innerHTML = bodyMatch[1];
                    
                    // Re-run any inline scripts
                    const scripts = document.getElementById('moduleContainer').getElementsByTagName('script');
                    Array.from(scripts).forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.parentNode.replaceChild(newScript, oldScript);
                    });
                    
                    console.log('Module loaded with feature flags enabled');
                    
                    // Check status after a delay
                    setTimeout(() => {
                        checkDataStatus();
                    }, 2000);
                }
            })
            .catch(err => {
                console.error('Failed to load module:', err);
                document.getElementById('moduleContainer').innerHTML = '<p style="padding: 20px;">Error loading module: ' + err.message + '</p>';
            });
            
        function checkDataStatus() {
            const status = document.getElementById('dataStatus');
            if (window.PROGRAMS && window.PROGRAMS_DATA_STATUS) {
                status.textContent = `Loaded ${window.PROGRAMS.length} programs from ${window.PROGRAMS_DATA_STATUS.source}`;
                status.style.color = window.PROGRAMS.length > 100 ? '#10b981' : '#f59e0b';
                
                // Also check state counts
                const stateCounts = {};
                window.PROGRAMS.forEach(p => {
                    if (p._primaryState) {
                        stateCounts[p._primaryState] = (stateCounts[p._primaryState] || 0) + 1;
                    }
                });
                console.log('State distribution:', stateCounts);
            } else {
                status.textContent = 'Programs not loaded yet';
                status.style.color = '#ef4444';
            }
        }
    </script>
</body>
</html>
