<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect Pro - Audio Studio</title>
    <style>
        :root {
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-card: #334155;
            --accent: #0D9488;
            --accent-light: #0891B2;
            --text-primary: #F8FAFC;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --success: #10B981;
            --warning: #FBBF24;
            --error: #DC2626;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 48px;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .api-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid var(--border);
        }
        
        .api-section h2 {
            font-size: 1.2rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .api-row {
            display: flex;
            gap: 16px;
            align-items: flex-end;
        }
        
        .form-group {
            flex: 1;
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        input[type="text"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--bg-secondary);
        }
        
        .scripts-grid {
            display: grid;
            gap: 16px;
        }
        
        .script-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .script-card:hover {
            border-color: var(--accent);
        }
        
        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .script-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scene-number {
            background: var(--accent);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        .script-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 16px;
            line-height: 1.7;
        }
        
        .script-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .status-generating {
            background: rgba(99, 102, 241, 0.2);
            color: var(--accent);
        }
        
        .status-done {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }
        
        .audio-player {
            width: 100%;
            height: 40px;
            margin-top: 12px;
        }
        
        .bulk-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .progress-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .progress-bar {
            width: 200px;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            width: 0%;
            transition: width 0.3s;
        }
        
        .output-section {
            margin-top: 32px;
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }
        
        .output-section h2 {
            margin-bottom: 16px;
        }
        
        pre {
            background: var(--bg-primary);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .voice-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        
        .voice-option {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .voice-option:hover {
            border-color: var(--accent);
        }
        
        .voice-option.selected {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .voice-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .voice-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .help-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        .divider {
            height: 1px;
            background: var(--border);
            margin: 24px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è CareConnect Audio Studio</h1>
            <p class="subtitle">Generate professional voiceovers for the onboarding intro using ElevenLabs</p>
        </header>
        
        <!-- API Configuration -->
        <section class="api-section">
            <h2>üîë API Configuration</h2>
            <div class="api-row">
                <div class="form-group">
                    <label for="apiKey">ElevenLabs API Key</label>
                    <input type="password" id="apiKey" placeholder="Enter your ElevenLabs API key">
                    <p class="help-text">Get your API key from <a href="https://elevenlabs.io" target="_blank" style="color: var(--accent);">elevenlabs.io</a></p>
                </div>
                <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
            </div>
            
            <div class="divider"></div>
            
            <h2>üé§ Voice Selection</h2>
            <p class="help-text" style="margin-bottom: 12px;">Select a voice for the narration. Recommended: Professional, warm, and clear.</p>
            <div class="voice-select-grid" id="voiceGrid">
                <!-- Populated by JS -->
            </div>
        </section>
        
        <!-- Bulk Actions -->
        <div class="bulk-actions">
            <div class="progress-info">
                <span id="progressText">0 of 6 generated</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" onclick="downloadTiming()">üì• Download timing.json</button>
                <button class="btn btn-primary" id="generateAllBtn" onclick="generateAll()">
                    ‚ö° Generate All Audio
                </button>
            </div>
        </div>
        
        <!-- Script Cards -->
        <div class="scripts-grid" id="scriptsGrid">
            <!-- Populated by JS -->
        </div>
        
        <!-- Output Section -->
        <section class="output-section">
            <h2>üìã Generated Timing Data</h2>
            <pre id="timingOutput">{
  "scenes": {
    // Timing data will appear here after generation
  }
}</pre>
        </section>
    </div>
    
    <script>
        // Script configuration for each scene - Clinical Professional Version
        const SCRIPTS = [
            {
                id: 'chaos',
                scene: 1,
                filename: 'intro-scene-1.mp3',
                title: 'The Chaos',
                text: "Every day starts the same way. Emails from admissions. Calls from families. Notes scattered everywhere. It's hard to know where to begin. What if there was one place where it all made sense? This is CareConnect Pro."
            },
            {
                id: 'dashboard',
                scene: 2,
                filename: 'intro-scene-2.mp3',
                title: 'The Dashboard',
                text: "Your dashboard is your home base. At a glance, you see your entire caseload ‚Äî who's in Week 1, who's approaching Day 14, who's heading toward discharge. No digging. No guessing. Just clarity."
            },
            {
                id: 'journey',
                scene: 3,
                filename: 'intro-scene-3.mp3',
                title: 'The Journey',
                text: "The Client Journey shows where every client is in treatment. Click any stage to filter your tasks to just those clients. From intake to alumni ‚Äî you always know where everyone stands."
            },
            {
                id: 'flightPlan',
                scene: 4,
                filename: 'intro-scene-4.mp3',
                title: 'The Flight Plan',
                text: "Your Daily Flight Plan organizes your work by urgency. Red zone for what's overdue. Purple for discharge prep. Yellow for today. Green for what's on track. Start with red. The rest will follow."
            },
            {
                id: 'programs',
                scene: 5,
                filename: 'intro-scene-5.mp3',
                title: 'Programs & Map',
                text: "When it's time to plan aftercare, search the Program Database by level of care, format, or location. Explore options on an immersive map. Add programs directly to a client's aftercare document."
            },
            {
                id: 'ready',
                scene: 6,
                filename: 'intro-scene-6.mp3',
                title: 'Ready',
                text: "CareConnect doesn't replace your clinical judgment. It gives you the clarity to use it. Track the journey. Clear your flight plan. Find the right programs. Support every family. You're ready."
            }
        ];
        
        // Popular ElevenLabs voices
        const VOICES = [
            { id: 'EXAVITQu4vr4xnSDxMaL', name: 'Sarah', desc: 'Warm, professional female' },
            { id: 'ErXwobaYiN019PkySvjV', name: 'Antoni', desc: 'Well-rounded male' },
            { id: 'VR6AewLTigWG4xSOukaG', name: 'Arnold', desc: 'Crisp, authoritative male' },
            { id: 'pNInz6obpgDQGcFmaJgB', name: 'Adam', desc: 'Deep, narrative male' },
            { id: 'yoZ06aMxZJJ28mfd3POQ', name: 'Sam', desc: 'Raspy, authentic male' },
            { id: '21m00Tcm4TlvDq8ikWAM', name: 'Rachel', desc: 'Calm, professional female' }
        ];
        
        let selectedVoice = VOICES[0].id;
        let generatedAudio = {};
        let timingData = { scenes: {} };
        
        // Initialize the page
        function init() {
            renderVoiceGrid();
            renderScriptCards();
            loadSavedApiKey();
        }
        
        function renderVoiceGrid() {
            const grid = document.getElementById('voiceGrid');
            grid.innerHTML = VOICES.map(voice => `
                <div class="voice-option ${voice.id === selectedVoice ? 'selected' : ''}" 
                     onclick="selectVoice('${voice.id}')">
                    <div class="voice-name">${voice.name}</div>
                    <div class="voice-desc">${voice.desc}</div>
                </div>
            `).join('');
        }
        
        function selectVoice(voiceId) {
            selectedVoice = voiceId;
            renderVoiceGrid();
        }
        
        function renderScriptCards() {
            const grid = document.getElementById('scriptsGrid');
            grid.innerHTML = SCRIPTS.map(script => `
                <div class="script-card" id="card-${script.id}">
                    <div class="script-header">
                        <div class="script-title">
                            <span class="scene-number">${script.scene}</span>
                            ${script.title}
                        </div>
                        <span class="status-badge status-pending" id="status-${script.id}">Pending</span>
                    </div>
                    <div class="script-text">"${script.text}"</div>
                    <div class="script-actions">
                        <button class="btn btn-secondary" onclick="generateSingle('${script.id}')">
                            Generate
                        </button>
                        <button class="btn btn-secondary" onclick="previewText('${script.id}')" title="Preview with browser TTS">
                            üîä Preview
                        </button>
                    </div>
                    <audio class="audio-player" id="audio-${script.id}" controls style="display: none;"></audio>
                </div>
            `).join('');
        }
        
        function loadSavedApiKey() {
            const saved = localStorage.getItem('elevenlabs_api_key');
            if (saved) {
                document.getElementById('apiKey').value = saved;
            }
        }
        
        function getApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                localStorage.setItem('elevenlabs_api_key', key);
            }
            return key;
        }
        
        async function testConnection() {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert('Please enter your API key');
                return;
            }
            
            try {
                const response = await fetch('https://api.elevenlabs.io/v1/user', {
                    headers: { 'xi-api-key': apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`‚úÖ Connected! Subscription: ${data.subscription?.tier || 'Unknown'}`);
                } else {
                    alert('‚ùå Invalid API key');
                }
            } catch (error) {
                alert('‚ùå Connection failed: ' + error.message);
            }
        }
        
        async function generateSingle(scriptId) {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert('Please enter your API key');
                return;
            }
            
            const script = SCRIPTS.find(s => s.id === scriptId);
            if (!script) return;
            
            updateStatus(scriptId, 'generating', 'Generating...');
            
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${selectedVoice}`, {
                    method: 'POST',
                    headers: {
                        'xi-api-key': apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: script.text,
                        model_id: 'eleven_monolingual_v1',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.75
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                // Store for download
                generatedAudio[scriptId] = audioBlob;
                
                // Get duration
                const duration = await getAudioDuration(audioUrl);
                timingData.scenes[scriptId] = {
                    duration: duration,
                    file: script.filename
                };
                
                // Update UI
                const audioEl = document.getElementById(`audio-${scriptId}`);
                audioEl.src = audioUrl;
                audioEl.style.display = 'block';
                
                updateStatus(scriptId, 'done', `Done (${duration.toFixed(1)}s)`);
                updateProgress();
                updateTimingOutput();
                
                // Auto-download
                downloadAudio(scriptId, script.filename);
                
            } catch (error) {
                console.error('Generation error:', error);
                updateStatus(scriptId, 'error', 'Error');
                alert(`Failed to generate: ${error.message}`);
            }
        }
        
        async function generateAll() {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert('Please enter your API key');
                return;
            }
            
            const btn = document.getElementById('generateAllBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div> Generating...';
            
            for (const script of SCRIPTS) {
                if (!generatedAudio[script.id]) {
                    await generateSingle(script.id);
                    // Small delay between requests to avoid rate limiting
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
            
            btn.disabled = false;
            btn.innerHTML = '‚ö° Generate All Audio';
            
            alert('‚úÖ All audio generated! Files have been downloaded.');
        }
        
        function getAudioDuration(url) {
            return new Promise((resolve) => {
                const audio = new Audio(url);
                audio.addEventListener('loadedmetadata', () => {
                    resolve(audio.duration);
                });
                audio.addEventListener('error', () => {
                    resolve(10); // Default fallback
                });
            });
        }
        
        function downloadAudio(scriptId, filename) {
            const blob = generatedAudio[scriptId];
            if (!blob) return;
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function downloadTiming() {
            const json = JSON.stringify(timingData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'timing.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function previewText(scriptId) {
            const script = SCRIPTS.find(s => s.id === scriptId);
            if (!script) return;
            
            // Use browser TTS for preview
            const utterance = new SpeechSynthesisUtterance(script.text);
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }
        
        function updateStatus(scriptId, status, text) {
            const badge = document.getElementById(`status-${scriptId}`);
            badge.className = `status-badge status-${status}`;
            badge.textContent = text;
        }
        
        function updateProgress() {
            const done = Object.keys(generatedAudio).length;
            const total = SCRIPTS.length;
            const percent = (done / total) * 100;
            
            document.getElementById('progressText').textContent = `${done} of ${total} generated`;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }
        
        function updateTimingOutput() {
            document.getElementById('timingOutput').textContent = JSON.stringify(timingData, null, 2);
        }
        
        // Initialize on load
        init();
    </script>
</body>
</html>

