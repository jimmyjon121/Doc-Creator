<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family First - Professional Aftercare Document Builder</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Cdefs/%3E%3Ccircle cx='32' cy='32' r='30' fill='%230099cc'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-family='Calibri, Arial, sans-serif' font-size='34' font-weight='700' fill='white'%3EF%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Calibri', Arial, sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #0066cc, #0099cc);
            padding: 24px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,102,204,0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .logo-circle {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 28px;
            color: white;
            font-weight: 700;
            backdrop-filter: blur(10px);
        }
        
        .header-text h1 {
            color: white;
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 2px;
            letter-spacing: -0.5px;
        }
        
        .header-text p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .programs-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8fafb;
            max-height: 70vh;
        }
        
        .selection-panel {
            width: 450px;
            background: white;
            border-left: 1px solid #e5e7eb;
            padding: 30px;
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 12px rgba(0,0,0,0.03);
        }
        
        .document-type-selector {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #bae6fd;
            box-shadow: 0 2px 8px rgba(0,153,204,0.08);
        }
        
        .doc-type-buttons {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .doc-type-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid #0099cc;
            background: white;
            color: #0099cc;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .doc-type-btn.active {
            background: #0099cc;
            color: white;
        }
        
        .client-info {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #bae6fd;
            box-shadow: 0 2px 8px rgba(0,153,204,0.08);
        }
        
        .client-info h3 {
            color: #0c4a6e;
            margin-bottom: 14px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .client-info input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e7ff;
            border-radius: 8px;
            margin-bottom: 0;
            font-family: -apple-system, 'Calibri', Arial, sans-serif;
            font-size: 15px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .client-info input:focus {
            outline: none;
            border-color: #0099cc;
            box-shadow: 0 0 0 3px rgba(0,153,204,0.1);
        }
        
        .search-box {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 15px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #0099cc;
            box-shadow: 0 0 0 3px rgba(0,153,204,0.1);
        }
        
        .filter-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #374151;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .filter-btn:hover {
            border-color: #0099cc;
            color: #0099cc;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .filter-btn.active {
            background: #0099cc;
            color: white;
            border-color: #0099cc;
            box-shadow: 0 2px 8px rgba(0,153,204,0.2);
        }
        
        .program-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .program-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .program-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-color: #cbd5e1;
        }
        
        .program-card.primary {
            border-color: #0099cc;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            box-shadow: 0 4px 12px rgba(0,153,204,0.15);
        }
        
        .program-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: bold;
            color: white;
            background: #0099cc;
        }
        
        .program-name {
            font-weight: bold;
            font-size: 15px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .program-location {
            color: #666;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .program-type {
            display: inline-block;
            padding: 2px 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 11px;
            color: #555;
            margin-top: 5px;
        }
        
        .program-info-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #0099cc;
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            z-index: 2;
            transition: all 0.3s;
        }
        
        .program-info-btn:hover {
            background: #0077aa;
            transform: scale(1.1);
        }
        
        .selected-section {
            flex: 1;
            overflow-y: auto;
        }
        
        .section-title {
            font-weight: 600;
            margin: 20px 0 16px 0;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 15px;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            color: #1e40af;
            border-left: 4px solid #0099cc;
        }
        
        .selected-program {
            background: white;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
            font-size: 13px;
            cursor: move;
            transition: all 0.3s;
        }
        
        .selected-program.dragging {
            opacity: 0.5;
            background: #f0f8ff;
        }
        
        .selected-program.drag-over {
            border-top: 3px solid #0099cc;
        }
        
        .drag-handle {
            cursor: move;
            color: #999;
            margin-right: 8px;
            font-size: 16px;
        }
        
        .program-order-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .order-btn {
            background: #0099cc;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .order-btn:hover {
            background: #0077aa;
        }
        
        .order-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #0099cc, #0077aa);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 24px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0,153,204,0.3);
            width: 100%;
            letter-spacing: 0.5px;
        }
        
        .generate-btn:hover {
            background: linear-gradient(135deg, #0077aa, #005588);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,153,204,0.4);
        }
        
        .generate-btn:active {
            transform: translateY(0);
        }
        
        .generate-btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .instructions {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9e7 100%);
            border: 1px solid #fbbf24;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(251,191,36,0.1);
        }
        
        .instructions h3 {
            color: #92400e;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .instructions ul {
            margin-left: 20px;
            color: #78350f;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .instructions ul li {
            margin-bottom: 6px;
        }
        
        .empty-state {
            text-align: center;
            color: #999;
            padding: 15px;
            font-style: italic;
            font-size: 13px;
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            border-bottom: 1px solid #2a2a3e;
        }

        body.dark-mode .panel {
            background: #1a1a2e;
            border: 1px solid #2a2a3e;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .program-card {
            background: #252538;
            border: 1px solid #3a3a4e;
        }

        body.dark-mode .program-card:hover {
            background: #2a2a3e;
            border-color: #4a4a5e;
        }

        body.dark-mode .program-card.selected {
            background: #2a3f5f;
            border-color: #3498db;
        }

        body.dark-mode input[type="text"],
        body.dark-mode select {
            background: #252538;
            color: #e0e0e0;
            border: 1px solid #3a3a4e;
        }

        body.dark-mode .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        body.dark-mode .modal-content {
            background: #1a1a2e;
            color: #e0e0e0;
            border: 1px solid #3a3a4e;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 50px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        body.dark-mode .theme-toggle {
            background: #252538;
            border-color: #3a3a4e;
            color: #e0e0e0;
        }

        /* Comparison View Styles */
        .comparison-view {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 1200px;
            height: 80vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            overflow: hidden;
        }

        .comparison-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comparison-content {
            display: flex;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .comparison-column {
            flex: 1;
            padding: 20px;
            border-right: 1px solid #ddd;
        }

        .comparison-column:last-child {
            border-right: none;
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 8px 15px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .quick-action-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        body.dark-mode .quick-action-btn {
            background: #252538;
            border-color: #3a3a4e;
            color: #e0e0e0;
        }

        body.dark-mode .quick-action-btn:hover {
            background: #2a2a3e;
        }

        /* Document History Panel */
        .history-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            display: none; /* Hidden by default */
        }
        
        .history-panel.active {
            display: block;
        }

        .history-panel.open {
            right: 0;
        }

        .history-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .history-item:hover {
            background: #f5f5f5;
        }

        body.dark-mode .history-panel {
            background: #1a1a2e;
        }

        body.dark-mode .history-item {
            border-bottom-color: #2a2a3e;
        }

        body.dark-mode .history-item:hover {
            background: #252538;
        }

        /* Analytics Dashboard */
        .analytics-dashboard {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .analytics-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .analytics-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 80%;
            max-width: 700px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            background: #0099cc;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }
        
        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .modal-close:hover {
            color: #f0f0f0;
        }
        
        .modal-body {
            padding: 20px;
            max-height: calc(80vh - 60px);
            overflow-y: auto;
        }
        
        .preview-section {
            margin-bottom: 20px;
        }
        
        .preview-section h3 {
            color: #0099cc;
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
        
        .preview-features {
            list-style: none;
            padding: 0;
        }
        
        .preview-features li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        .preview-features li strong {
            color: #333;
        }
        
        .preview-contact {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        
        .preview-contact div {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .modal-actions {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .add-from-preview {
            background: #0099cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .add-from-preview:hover {
            background: #0077aa;
        }
        
        .add-from-preview.selected {
            background: #dc3545;
        }
        
        /* Print Styles - Professional Clean Document */
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .main-content { flex-direction: column; }
            .programs-panel, .selection-panel { width: 100%; max-width: 100%; }
            .program-grid { grid-template-columns: 1fr; }
            .filter-buttons, .quick-actions { flex-wrap: wrap; }
            .theme-toggle { top: 10px; right: 10px; }
            .history-panel { width: 100%; }
            .comparison-view { width: 95%; }
            .comparison-content { flex-direction: column; }
        }
        
        @media print {
            @page {
                size: letter;
                margin: 1in 0.75in 1in 0.75in; /* Top, Right, Bottom, Left - content width ~6.5" */
            }
            
            /* Hide ALL UI elements during print */
            .theme-toggle,
            .history-panel,
            .comparison-view,
            .analytics-dashboard,
            .container,
            .modal,
            .quick-actions,
            #historyPanel,
            #comparisonView,
            #analyticsDashboard {
                display: none !important;
            }
            
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .container {
                display: none !important;
            }
            
            .document-output {
                display: block !important;
                width: 100%;
                margin: 0;
                padding: 0;
                background: white;
                color: black;
                font-family: Helvetica, Arial, "Segoe UI", sans-serif;
                font-size: 11pt;
                line-height: 1.6;
            }
            
            .doc-page {
                position: relative;
                width: 100%;
                padding: 0;
                page-break-inside: avoid;
                overflow: visible; /* ensure header image not clipped */
            }
            
            /* Hide web elements completely */
            .modal, .program-info-btn, .program-badge {
                display: none !important;
            }
        }
        
        /* Document output styles */
        .document-output {
            display: none;
            font-family: Helvetica, Arial, "Segoe UI", sans-serif;
            font-size: 11pt; /* Body size 11-12pt as specified */
            line-height: 1.6;
            color: #000;
        }
        
        .doc-page {
            background: white;
            position: relative;
            min-height: 100%;
            overflow: visible; /* allow header graphics to render fully */
        }
        
        .doc-content {
            padding-bottom: 60px; /* Space for footer */
        }
        
        /* Letterhead Header */
        .doc-letterhead {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 0;
            margin-top: 8px; /* ensure image isn't clipped at page top */
        }
        
        .doc-letterhead-logo {
            height: 80px !important; /* fixed visual height to avoid partial decode/cropping */
            width: auto !important;
            max-width: 160px !important;
            margin: 0 auto 15px !important;
            display: block !important;
            object-fit: contain !important;
            object-position: center center !important;
            /* Ensure image loads properly in print */
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        
        .doc-logo {
            width: 200px;
            height: auto;
            margin: 0 auto 20px;
            display: block;
        }
        
        .doc-letterhead-lockup {
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }
        
        .doc-letterhead-icon {
            width: 40px;
            height: 40px;
            background: #0099cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        
        .doc-letterhead-text {
            text-align: left;
        }
        
        .doc-letterhead-text h1 {
            font-size: 18pt;
            color: #0099cc;
            margin: 0;
            font-weight: bold;
            line-height: 1;
        }
        
        .doc-letterhead-text p {
            font-size: 10pt;
            color: #0099cc;
            margin: 2px 0 0 0;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        /* Document Body */
        .doc-greeting {
            font-size: 11pt;
            font-weight: normal;
            margin-bottom: 8px;
        }
        
        .doc-intro {
            font-size: 11pt;
            margin-bottom: 18pt;
            font-style: italic;
            text-decoration: underline;
        }
        
        /* Section headers - H1-style */
        .doc-section-header {
            font-size: 12pt;
            font-weight: bold;
            margin: 18pt 0 14pt 0;
            text-align: left;
        }
        
        /* Category headers - H2-style */
        .doc-category-header {
            font-size: 11pt;
            font-weight: normal;
            margin: 14pt 0 10pt 0;
        }
        
        /* Program Cards */
        .doc-program {
            margin-bottom: 18pt;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        /* Program title line with en dash */
        .doc-program-title {
            font-size: 11pt;
            font-weight: bold;
            color: #000;
            margin-bottom: 6pt;
        }
        
        /* Descriptor line with pipes */
        .doc-program-descriptor {
            font-size: 11pt;
            margin-bottom: 10pt;
        }
        
        .doc-program-descriptor strong {
            font-weight: bold;
        }
        
        /* Program Details heading */
        .doc-program-details-heading {
            font-weight: bold;
            font-size: 11pt;
            margin-bottom: 8pt;
            margin-top: 10pt;
        }
        
        /* Bullet lists */
        .doc-program-bullets {
            margin: 0 0 10pt 20px;
            padding-left: 0;
            list-style: none;
        }
        
        .doc-program-bullets li {
            font-size: 11pt;
            margin-bottom: 6pt;
            position: relative;
            padding-left: 15px;
        }
        
        .doc-program-bullets li:before {
            content: "•";
            position: absolute;
            left: 0;
        }
        
        /* Sub-bullets with dashes */
        .doc-sub-bullets {
            margin: 4pt 0 0 20px;
            padding-left: 0;
            list-style: none;
        }
        
        .doc-sub-bullets li {
            font-size: 11pt;
            margin-bottom: 2pt;
            position: relative;
            padding-left: 15px;
        }
        
        .doc-sub-bullets li:before {
            content: "–";
            position: absolute;
            left: 0;
        }
        
        /* Contact Information block */
        .doc-contact-section {
            font-size: 11pt;
            line-height: 1.4;
            margin-top: 10pt;
        }
        
        .doc-contact-section a {
            color: #0099cc;
            text-decoration: underline;
        }
        
        /* Footer - single line with dot separators */
        .doc-footer {
            position: fixed;
            bottom: 20px;
            left: 50px;
            right: 50px;
            text-align: center;
            font-size: 10pt;
            color: #333;
            background: white;
            padding: 10px 0 0 0;
            border-top: 1px solid #ccc;
        }
        
        /* Mini card styles for AT HOME sections */
        .doc-mini-card {
            margin-bottom: 12pt;
        }
        
        .doc-mini-title {
            font-size: 11pt;
            font-weight: bold;
            margin-bottom: 2pt;
        }
        
        .doc-mini-blurb {
            font-size: 11pt;
            margin-bottom: 4pt;
        }
        
        .doc-mini-contact {
            font-size: 11pt;
        }
        
        /* Special emphasis for AT HOME Recommendation */
        .doc-emphasis-section {
            font-style: italic;
            text-decoration: underline;
        }
        
        /* Print-specific styles for blank lines */
        @media print {
            .doc-mini-title, .doc-mini-blurb, .doc-mini-contact {
                min-height: 1.2em;
            }
            
            .doc-footer {
                position: fixed;
                bottom: 0.5in;
                left: 0;
                right: 0;
                text-align: center;
                font-size: 10pt;
                color: #333;
                background: white;
                padding: 10px 0;
                z-index: 100;
            }
            
            .doc-content {
                padding-bottom: 80px; /* More space for fixed footer */
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">🌙</span>
        <span id="themeText">Dark Mode</span>
    </button>
    
    <!-- History Panel -->
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <h3>Document History</h3>
            <button onclick="toggleHistory()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">✕</button>
        </div>
        <div id="historyContent"></div>
    </div>
    
    <!-- Comparison View -->
    <div class="comparison-view" id="comparisonView">
        <div class="comparison-header">
            <h3>Program Comparison</h3>
            <button onclick="closeComparison()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">✕</button>
        </div>
        <div class="comparison-content" id="comparisonContent"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="logo-circle">F</div>
                <div class="header-text">
                    <h1>Family First</h1>
                    <p>ADOLESCENT SERVICES</p>
                </div>
            </div>
            <div style="font-size: 14px; color: rgba(255,255,255,0.9); text-align: right;">
                Professional Aftercare Document Builder<br>
                <small style="color: rgba(255,255,255,0.7); font-size: 12px;">💾 Generate → Print → Save as PDF</small>
            </div>
        </div>
        
        <!-- Mode Selection -->
        <div class="mode-selector" style="background: linear-gradient(135deg, #0066cc 0%, #003d7a 100%); padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0, 51, 102, 0.2);">
            <h2 style="color: white; margin-bottom: 15px; font-size: 18px;">Choose Your Input Method</h2>
            <div class="mode-buttons" style="display: flex; gap: 15px;">
                <button id="quickModeBtn" class="mode-btn" style="flex: 1; padding: 15px 20px; background: white; color: #0066cc; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onclick="selectMode('quick')">
                    <div style="font-size: 20px; margin-bottom: 5px;">🚀</div>
                    <div>Quick Mode</div>
                    <small style="display: block; font-weight: normal; color: #666; margin-top: 5px;">Use Chrome Extension or Paste Info</small>
                </button>
                <button id="guidedModeBtn" class="mode-btn active" style="flex: 1; padding: 15px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onclick="selectMode('guided')">
                    <div style="font-size: 20px; margin-bottom: 5px;">📋</div>
                    <div>Guided Mode</div>
                    <small style="display: block; font-weight: normal; color: rgba(255,255,255,0.9); margin-top: 5px;">Select from Program Database</small>
                </button>
            </div>
        </div>
        
        <!-- Quick Mode Panel -->
        <div id="quickModePanel" class="mode-panel" style="display: none;">
            <div class="quick-mode-content" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="color: #0066cc; margin-bottom: 20px;">Quick Program Information Entry</h3>
                
                <div class="extension-info" style="background: #f0f8ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #0066cc;">
                    <h4 style="margin-top: 0; color: #0066cc;">Chrome Extension Available!</h4>
                    <p style="margin: 10px 0;">Install our Chrome Extension to automatically extract program information from any website.</p>
                    <button onclick="window.open('chrome://extensions/', '_blank')" style="background: #0066cc; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">Open Extensions Page</button>
                    <small style="color: #666;">Load the extension from the 'chrome-extension' folder</small>
                </div>
                
                <div class="paste-section">
                    <label for="quickProgramInfo" style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        Or paste program information here:
                    </label>
                    <textarea 
                        id="quickProgramInfo" 
                        placeholder="Paste website content, brochure text, or any program information here. Our AI will analyze and format it into a professional document."
                        style="width: 100%; height: 300px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"
                    ></textarea>
                    
                    <div class="api-key-notice" style="margin-top: 10px; padding: 12px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; font-size: 13px; color: #856404;">
                        <strong>⚠️ API Key Required:</strong> To use AI analysis, add your OpenAI API key in line 1352 of this file. 
                        Replace <code>YOUR_OPENAI_API_KEY</code> with your actual key.
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <input type="text" id="quickClientName" placeholder="Client Name (Required)" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 15px;">
                    
                    <button onclick="generateFromWebsite()" style="width: 100%; padding: 15px; background: #0066cc; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        🤖 Generate Document with AI
                    </button>
                </div>
                
                <div id="quickModeStatus" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
            </div>
        </div>
        
        <!-- Guided Mode Panel (existing content) -->
        <div id="guidedModePanel" class="mode-panel main-content">
            <div class="programs-panel">
                <div class="instructions">
                    <h3>📋 How to Create Professional Documents:</h3>
                    <ul>
                        <li>Select <strong>"Options"</strong> for multiple program recommendations</li>
                        <li>Select <strong>"Plans"</strong> for single program (discharge facesheet)</li>
                        <li>Click the <strong>"i"</strong> button to preview program details</li>
                        <li><strong>Click programs</strong> to add to your selection</li>
                        <li><strong>Drag & drop</strong> selected programs to reorder them</li>
                        <li>Click "Generate Document" → Use Print dialog → Save as PDF</li>
                    </ul>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="selectAllPrograms()">Select All</button>
                    <button class="quick-action-btn" onclick="clearAllPrograms()">Clear All</button>
                    <button class="quick-action-btn" onclick="selectByCategory()">Select Category</button>
                    <button class="quick-action-btn" onclick="comparePrograms()">Compare (<span id="compareCount">0</span>)</button>
                    <button class="quick-action-btn" onclick="toggleHistory()">History</button>
                    <button class="quick-action-btn" onclick="exportDatabase()">Export DB</button>
                    <button class="quick-action-btn" onclick="importDatabase()">Import DB</button>
                </div>
                
                <input type="text" class="search-box" id="searchBox" placeholder="🔍 Search programs by name, location, features, or contacts..." style="margin-top: 10px;">
                
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterPrograms('all', this)">All</button>
                    <button class="filter-btn" onclick="filterPrograms('rtc', this)">RTC</button>
                    <button class="filter-btn" onclick="filterPrograms('tbs', this)">TBS</button>
                    <button class="filter-btn" onclick="filterPrograms('wilderness', this)">Wilderness</button>
                    <button class="filter-btn" onclick="filterPrograms('php-iop', this)">PHP/IOP</button>
                    <button class="filter-btn" onclick="filterPrograms('transitional', this)">Transitional</button>
                    <button class="filter-btn" onclick="filterPrograms('virtual', this)">Virtual</button>
                    <button class="filter-btn" onclick="filterPrograms('asd', this)">ASD</button>
                    <button class="filter-btn" onclick="filterPrograms('evaluation', this)">Evaluation</button>
                    <button class="filter-btn" onclick="filterPrograms('athome', this)">AT HOME</button>
                </div>
                
                <div class="program-grid" id="programGrid">
                    <!-- Programs will be loaded here -->
                </div>
            </div>
            
            <div class="selection-panel">
                <div class="document-type-selector">
                    <h3 style="font-size: 14px; color: #0099cc; margin-bottom: 8px;">Document Type:</h3>
                    <div class="doc-type-buttons">
                        <button class="doc-type-btn active" onclick="setDocumentType('options', this)">OPTIONS (Multiple)</button>
                        <button class="doc-type-btn" onclick="setDocumentType('plans', this)">PLANS (Single)</button>
                    </div>
                </div>
                
                <div class="client-info">
                    <h3>Client Information</h3>
                    <input type="text" id="clientName" placeholder="Client Name (Required)">
                    <label style="display: flex; align-items: center; gap: 8px; margin-top: 10px; font-size: 14px;">
                        <input type="checkbox" id="includeAtHome" style="width: 18px; height: 18px;">
                        <span>Include AT HOME Recommendations</span>
                    </label>
                </div>
                
                <div class="selected-section">
                    <div class="section-title" id="selectedTitle">Selected Programs (Drag to reorder)</div>
                    <div id="selectedList">
                        <div class="empty-state">Click programs to add to document</div>
                    </div>
                </div>
                
                <button class="generate-btn" id="generateBtn" onclick="generateDocument()">
                    📄 GENERATE DOCUMENT
                </button>
            </div>
        </div>
    </div>
    
    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Program Details</h2>
                <button class="modal-close" onclick="closePreview()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-actions">
                <button id="modalAddBtn" class="add-from-preview" onclick="toggleFromPreview()">Add to Selection</button>
                <button onclick="closePreview()" style="padding: 10px 20px; background: #e0e0e0; border: none; border-radius: 5px; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden document output for printing -->
    <div class="document-output" id="documentOutput"></div>
    
    <script>
        // Logo - Family First WebP image
        const LOGO_WEBP = 'data:image/webp;base64,UklGRjQvAABXRUJQVlA4TCgvAAAv/8F/EGph0EiKmF38u344aBVExATwb8cj8wP3Gy8jb7/TybRStDOsJbta6+Nce9qpLvUPfgJgfSo4AhcgYc2mUZ1aONYRYULoY59U1dBKe2KDb70cJ+njwMOlDnhMekMuWwWcAY202ZpyL8jPsdz/v162mwf0iWN4BszMzAzPgpl9ngLT40ieS3LnwPf7+/2+v/+47xobyzQyzMzMcEFlLSjzkYVd3qLM3D4A5q3aI48M6axLriiZL8kyhjPlypAs44gyM3MruQ1nyqiqwhkZea+9a+RZVYER4RxZ7vcBhFxpZBmnIEeWmXtkGMsd15A88sKsKuZwplx5Zblh3LKSGR0Gtiz3qLIL8y7PquOG5BTklDyqrt21jiwz2jpuHwBdGU5UcZeZtywzzEITSU5WR7p0EYEFejCAorRoAklwIwFAmGz4SWlVVnD3VO7utgPulJQcHQNkCkkAAJaRZNu2be/Lo7Vt27a9+7Rtm2ffYG3bZkOLtu24bXOOtMQMopPOBZ6Ah/f+rEgA9uyNc6DvV2/uv6xi9bW6ZHWtJW1x+1XcffpNfZ/ve5/3waY2NA8KrayijOFiHyANZkZmwmlHWJx2gj/lDMvTFPSh0F5YUHWjpotzhOVpaE+SI/TiwlLEc4eghxl7QrM83TPPGYJCF6UnP9vGHFSR6VKhVN7LAcJEt6D0Hh3BE9gTz+gIHtMU2pvOEB70zbKU7eKbM4SG+QI5QFhCw4z+9J4wHSIX6F238CFCoq1tSyrdIf9PC3aAS6kDjAxtdxETJnHCvEkIsm2nbfa/slq2vr5YMmMYDGGqJDGSpEiS+9Qy411SV8/+7FjbttySMvF2l3PK3d3d3d3b3d3d/fT5ZVe9UmGjNYaKcAirB4C7Q9Q7xGECdISdHHfISCuqCAvd3d3dYQis5RLRYckcalWOtqR6BtATQCIdQMdI6LI7wu2tjNUhDrGeqMKaCR7ZEGyvCgkJ3R0mUBLhLlmnnAyLOiWzyAfQDMAtcj0hDnsOaETe/kVo5FnFRUboqf3oF2ITcHeXVtz2MPDMDrEESJJM2+pn27Zt27Zt27Zt27b9bdu27S8xAMC0bf7/JYxmliNDZWYnM2iOsczYf0mQJMltkx0T0K2fDQKL3QH003gKyAEvUAUo4AACQCIoBFWgG4yDWYAGi2AbnIPrWgC6Ym0tOGsGCyf7iybQdQnVIOE3Lwcg23sAMi03CvABWzuwAKGgCHSAb2AV3Bmzo1wl+Araqw8JzIHKmYvlNgAREAIwEAhKwQBYBq/m3PxRtwWKj1kDBDPlqvcCMWAGkkArwObNM/M3OsIN9v+oTLkHQAHUgC+oAL/Bi3kseNoAKAc+L1kopwAIgQzwBtWPAz4sCCse5xKAF5CuK18AaAECZINpcG+BOcqeQVYNoCkfABiAyeeAPxUWqBVfDQpupSHZkwY6IA/8B5AFbg78AzlAO53QAZIgvAk8mhB2gFEQBiSSNoAU6G8SbJkwgs1NAj1AkpgBdMDx7KOYSILbs3/PFhMwgBm4rx68mWCuePW3CxiT7f9jdIKpChPPio97xoakOqYIbLbVaEKaB/29CokTQHCloPHBTFQfDDQA3WySBAiANLBrAgt2Ngz4EyIF4ARmTGz3/D3p5AcQ/RxwaaI7ZjUQTnQA4uv8OIuAYHLvmcQ2xPAp4NAiITgA8YApiQGkWvdhEXEfv/QnSStaFMDBhEXHJmCQoCJYM8AOYCxKngzYZhLS/2cCv2+1aJk6biH5AKhADDi1qAlOTjdw0rmqt+hZf7qBE89Vuf2i8KgBXlnI1wLLWblKwzsOmUDGozO3G8DUkgVukVgfQ7lhZebnSLoY5eqkyIWKiazfpnv/6ScdNoF0ackeM29hzjPMe4ezq3f6ZQPJMumw/n5Qilyaq8dpQvSkpBI74E8WuFtIcLxrB26ZhDHOACzBivmrBd6RWJ3Acj8X5+ikfCQaw+obs+6BQe0IJHNDUJUNebZGnnTH//xenOtRr7OYIACa4KenIeER6CqxiGkCKfZYQ1C2ZPe578C26j6wvciD1C758QX7xZGC7ydKDFEFfcw/ffAcz8jVZUO572HdwQ6yY2jR6viCvKc4zw+500QQRVydN7/wwTGRFVkqqV35B7JDfWDN0mWpcQIr2p1Wp7ofQBf9eDLg+R5ehXxGE1kyH5eP5HnY8U67TkteGE3k88VBloBHNuq0b8CjWM8Yyq+u32Qzbz/Wxpm3b906XR1Degf9ZxX8ao83gGWA+WIUXqV24vpNPuv+z9q5pm6dpXTizY759/El7D7S7wI+teYFFphG1OAJrfmDtbU1v5cNxfcsMIsjBFedMX4TkN6e+WAk1qQJcWPUznkF1txwY9gs6BMnuL3e0f0QSUujuSeGSvMMCCQTI+HBub2kR+y3seUgUeVKU+7/XR1Lu3wLWrIbo2JLdsk3YZP9sanUuePJC7aaa3v3MKA1vzFCBvMMGk0UYretLxhJXnHt5pYLZirJ1MuJ0XJDhhJHoGu7s1EAHsVxRlBrTv3nqDo0BK3LqOk2BPXIOrXAQ2z1fiujxxHBvtv/0izxRTcj6Mzbp9jjMWQmdgr2jhi5haI2aQ61wNXP0UmHHaPpvoftZ20tXAAl6YgBFMGSuSMKrwtd3s2ourPAxii8EfscHChEa6ARxLoba+hPKomJQc346k7cVzfrty8GAaKzUQKwu/soUefYdjLtOjLSbkjmk06xy6ozR4gLLZkjfPCUo9OZtzcj7oyfV7ZGbatTKAFYbDhstbNBhjWz7v+MvGsOtC0UsZ/DRgXA4yqwsK9iYjw2gN6EsbYrMQV+bC0i1NQ7uqqYWpcNofscm+6oBwbR2BEApOZcXpn9jhxIqYsCw1SZCwfKR8Zlw+iWDVUEurFnWMEwEQDINZsDfPBQ6AiPDaSXb6EPHsUGm4Gs+ADrDhfjDDk6rGFDOev+zVJpp8ALHnYu/D0u0EXwuJ+Dts87G8zdY1rQL/C21Em+HxAYNn4SWT35uGfDOfm4i2eUwPuyWxSbAziYZorEhrp1wQa0dpVFoIMNiagDCA3Qeg/+oJJcnXlsRGc//k/YBh+FPpHIXM6KjZsRNQyyMW3JluEVhO9PBPYCrySwa+P2TnvuKjaqR15QoH2forQrBoMa9qn2DBnWsGGddf+lSzQkwA7IyLqC1OqNmVjKTzkd2MDuAG9WASOAUlAAK/hrvGzLt6TLRtbNNxH6dfbduJi0pYyXuIINJCMb22mXcxxtoTuT2oQEyJSYR5mLXO2ywXULHQEcib7enjIuIgVujJVYOj2GDe+063mXgHoFQEPCGBPeiaaTcnsYZuMbztEZ7H9AOmrkm2fMGyeLJh22TAKHYGtS8sBKOHbEuyRTMs/WMBF846Ng87I7Eo3lsz6XVS8zJoRVc78M9ALcBOO4xmks7YNMCpvTCfaVHTcKz3EyCzMx9NIEgL3I/1xWuyqYINYsUwssoBfpn12BdGKSGEjGLtwvyzdG/BzOfgQmittHN1EABW6Cf9WTilzFhLHAFiG0X+nOGZ8/b4w6Jo0vAxxuX/Eusgw2M4429gaZODanM+CLyNdIMtXUYWwMr8g3Mnl847CyAMxByDEJ1ZNxpjFDQZcJpJsuMcAspBTT0G18cQYnlY8sE8nSgToJrg6hTYYgsxTfYJNT1DGZfJkFLnCVSBKEog3c17iIQLdTzkcmlDt8cAdXizhw+AHmqzcuoomqNb8yqQxG4SVcNXLo4ehFvs8XJLBmJxPLS8cVDFw/QjFsdm1cDK9Kj8mlB/d63yfszxYaF36Oh5lghkc3mUAZ8gj0iVbMRbrIXSaZbmqXgTWlnijcdQVKxkTuL85kM0dHsLb0A4S6qghYNCbGm4YJ5xawwRRbDHNNoZc1JopcyaTz/WCjaepCBOQaE0WeZuK5mG1xqhAjDYyJ0oFjJvJl5+EtJ9nBRJFnmKl8Od83C20x2Wbud1D4GZqHCesOTcZDvmn47Erf19MU1A127Wq8gbrxh12HFGaY4yFd4kxIgSKQuXD2KdhaPdNcg0tJXKCOhPqthbKHUD9jYURVhpmUhoGykN9x2DCoZooz8JiYehcTEKvD2EDOWIgmyp1MTi+9WUCsCWH7yBILh+9mghr8AEwK8q393zy2iifCeMr5xCR1B0w1clXWd56X5/MFhzJRfdlJAuHpPOdSGlk4kcnqH2EmePu9a3maZyeRDIUzYYVpSRs87TOb5BlwcCmLCxN+2KTPSWMYBzFksYZJ6xu7BMIj+psyynOybBPfkl2ZuG4XZDDFl1T6yv2y3L0p7pm8NoZ1CGT3Mp4CEMbBs1lROpehfKOf2UKtnQM/j0xiQfqR1g5ofKSV5Q4ejdkO8gJaPWRElhQAA+';

        // App Configuration
        const appConfig = {
            version: "2.1.0",
            lastUpdated: "2025-09-11",
            companyName: "Aftercare Planning Services",
            openaiApiKey: "YOUR_OPENAI_API_KEY", // IMPORTANT: Replace with your OpenAI API key
            // To get an API key: https://platform.openai.com/api-keys
            features: {
                enableDarkMode: true,
                enableAnalytics: false,
                enableAutoSave: true,
                sessionTimeout: 1800000, // 30 minutes
                maxDocumentHistory: 10
            }
        };

        // Program database metadata
        const programDatabase = {
            version: "2.0.0",
            lastUpdated: "2025-09-11",
            totalPrograms: 40
        };

        // Complete program database - Comprehensive list of treatment programs
        const programs = [
            // ==================== VIRTUAL PROGRAMS ====================
            {
                id: 'charlie-health',
                name: 'Charlie Health Virtual IOP Program',
                location: 'Virtual',
                type: 'Virtual IOP',
                category: 'virtual',
                programCategory: 'Virtual / Outpatient Programs',
                levelOfCare: 'Virtual Intensive Outpatient Program (IOP) for adolescents and young adults ages 13–25 in need of structured, higher-acuity mental health care from home. The program typically runs for 6–10 weeks and includes 9–11 hours of treatment per week via secure video conferencing.',
                features: [
                    'Group Therapy: 3 hours of therapy 3 times per week focused on connection, skill-building, and peer support',
                    'Individual Therapy: Weekly 1-hour individual session tailored to personal goals and challenges',
                    'Family Therapy: 1–2 hours per week involving family members to improve communication and support healing',
                    'Psychiatry Services: Psychiatric assessment and medication management as needed',
                    'Flexible Scheduling: Evening sessions available to accommodate school or extracurricular commitments',
                    'Accessible Virtual Format: Services can be accessed via computer, tablet, or phone'
                ],
                contact: {
                    contactPerson: 'Gabriella H.',
                    phone: '561.203.5396',
                    website: 'https://www.charliehealth.com'
                }
            },
            {
                id: 'discovery-virtual-php-iop',
                name: 'Discovery Mood & Anxiety Virtual PHP/IOP',
                location: 'Florida (Virtual)',
                type: 'Virtual PHP/IOP',
                category: 'virtual',
                programCategory: 'Virtual / Outpatient Programs',
                levelOfCare: 'Secure, HIPAA-compliant virtual programming for adolescents ages 11–17 needing continued therapeutic care while living at home.',
                features: [
                    'PHP & IOP: Multiple weekly sessions tailored to teen availability',
                    'Virtual Individual, Group, and Family Therapy: Real-time treatment with licensed clinicians',
                    'Psychiatric Oversight: Medication management and remote evaluations',
                    'Parent Involvement: Integrated family sessions and check-ins',
                    'School Coordination: Adjusted schedules to accommodate academic needs'
                ],
                contact: {
                    phone: '(954) 825-9887',
                    website: 'www.discoverymood.com'
                }
            },
            {
                id: 'aane-virtual',
                name: 'AANE (Association for Autism and Neurodiversity)',
                location: 'Virtual',
                type: 'Virtual Support Services',
                category: 'virtual',
                programCategory: 'Virtual / Outpatient Programs',
                levelOfCare: 'Virtual services for adolescents and families with autism spectrum disorders.',
                features: [
                    'Parent & Family Consultation: Calls with resource specialists',
                    'Peer Connections: Virtual social groups and events',
                    'Advocacy & Resources: Tools to navigate school and clinical systems'
                ],
                contact: {
                    website: 'https://aane.org/'
                }
            },
            {
                id: 'bend-health',
                name: 'Bend Health',
                location: 'Virtual',
                type: 'Virtual ASD Services',
                category: 'virtual',
                programCategory: 'Virtual / Outpatient Programs',
                levelOfCare: 'Fully virtual platform offering behavioral health coaching and therapy for children and adolescents.',
                features: [
                    'Individual Coaching: Ongoing virtual sessions for ASD youth',
                    'Parent Coaching: Training and education for caregivers',
                    'Online Accessibility: Secure, convenient platform for remote engagement'
                ],
                contact: {
                    website: 'https://www.bendhealth.com/'
                }
            },
            
            // SOBER LIVING / TRANSITIONAL
            {
                id: 'last-house',
                name: 'The Last House',
                location: 'Los Angeles, CA',
                type: 'Sober Living',
                category: 'transitional',
                programCategory: 'Transitional Living / Sober Living',
                levelOfCare: 'Sober living program for young adult men (18+) located in West Los Angeles.',
                features: [
                    'Community-Oriented Housing: Residents live in structured homes with support from peers and staff',
                    'Certified Staff: Team includes professionals with backgrounds in counseling, employment services, and wellness',
                    'Life in LA Recovery Community: Access to over 3,000 recovery meetings weekly',
                    'Fun in Sobriety Philosophy: Weekly and quarterly sober activities including group outings, surfing, golf, snowboarding',
                    'Accountability: House meetings, curfews, and community support help residents stay on track with recovery'
                ],
                contact: {
                    phone: '866.677.0090',
                    address: '3101 Ocean Park Blvd #302, Santa Monica, CA 90405',
                    website: 'https://thelasthouse.net'
                }
            },
            {
                id: 'patton-sober-living',
                name: 'Patton Sober Living Homes',
                location: 'Dallas, TX',
                type: 'Sober Living',
                category: 'transitional',
                programCategory: 'Transitional Living / Sober Living',
                levelOfCare: 'Structured sober living program for young adult men in Dallas, Texas.',
                features: [
                    'Random Drug Testing: Residents are drug tested randomly at least once weekly and breathalyzed daily',
                    'Community & House Meetings: Three structured group meetings per week, led by licensed clinicians',
                    'Employment Coaching: Residents receive assistance with job placement, resume building, and interview preparation',
                    'Educational Support: Located near Richland College with personal support for academic success',
                    'Independent Living Skills: Daily chores, cooking, laundry, and personal care responsibilities',
                    '12-Step Integration: Active participation in a 12-Step program',
                    'Family Communication: Biweekly calls from the Program Director'
                ],
                contact: {
                    contactPerson: 'Austin Shook, Program Director',
                    phone: '(469) 974-4639',
                    address: '13028 Fall Manor Dr, Dallas, TX 75243',
                    website: 'https://pattonsoberliving.com'
                }
            },
            {
                id: 'resilience-recovery',
                name: 'Resilience Recovery Residences',
                location: 'West Palm Beach, FL',
                type: 'Transitional Living',
                category: 'transitional',
                programCategory: 'Transitional Living / Sober Living',
                levelOfCare: 'Structured transitional living program for young adult men ages 16+ who have completed primary treatment.',
                features: [
                    'Orientation Phase (2–4 Weeks): Daily chores, wake-up routines, seven 12-step meetings per week',
                    'Level 1 (14–90 Days): Six 12-step meetings/week, one meeting commitment, 9+ hours of IOP or therapy',
                    'Level 2 (60–120 Days): Completion of Step 5, increased leadership in community',
                    'Level 3 (120+ Days): Step 9 completion, leadership role, full tech privileges and car access'
                ],
                contact: {
                    contactPerson: 'Christopher Martinez, Owner',
                    phone: '424-254-4304',
                    address: '3011 Poinsettia Ave, West Palm Beach, FL 33407',
                    website: 'www.resiliencerecoveryresources.com'
                }
            },
            {
                id: 'live-strong-house',
                name: 'Live Strong House',
                location: 'Layton, UT',
                type: 'Transitional Living',
                category: 'transitional',
                programCategory: 'Transitional Living / Sober Living',
                levelOfCare: 'Residential treatment program for adolescent and young adult males.',
                features: [
                    '3:1 Household Model: Three students per home with dedicated life coaches',
                    'Daily Life Structure: Flexible weekday and weekend schedules',
                    'Individual Therapy: Multiple sessions per week',
                    'Group Therapy: Topics include trauma, social skills, communication',
                    'Adventure Therapy: Two recreation days per week',
                    'Community Leadership: Weekly student-led group meetings',
                    'Monthly Excursions: Wilderness and off-campus trips',
                    'Weekly Service: Built-in humanitarian service opportunities'
                ],
                contact: {
                    contactPerson: 'Paul Taylor',
                    phone: '928.300.5699',
                    email: 'ptaylor@livestronghouse.com',
                    address: '377 N. Marshall Way, Layton, UT 84041',
                    website: 'www.livestronghouse.com'
                }
            },
            {
                id: 'serenity-lodge',
                name: 'Serenity Lodge',
                location: 'Nicholson, PA',
                type: 'Residential',
                category: 'rtc',
                programCategory: 'Residential Treatment Centers (RTC)',
                levelOfCare: 'Comprehensive treatment for young men with addiction.',
                features: [
                    'Partial Hospitalization Program',
                    'Intensive Outpatient',
                    'Certified School Program with Licensed Teacher',
                    'Structured Sober Living',
                    'Outdoor Adventure Trek Program',
                    'Individual & Group Counseling',
                    'Family Counseling',
                    'Life Skills Program',
                    '15-Acre Facility with Indoor Gym, Basketball Court',
                    'Recovery Yoga & Meditation'
                ],
                contact: {
                    phone: '(570) 222-3449',
                    address: '21 Weida Ct Nicholson, PA 18446',
                    email: 'info@serenitylodgerecovery.com'
                }
            },
            
            // RESIDENTIAL TREATMENT CENTERS (RTC)
            {
                id: 'stonewater',
                name: 'Stonewater Adolescent Recovery Center',
                location: 'Oxford, MS',
                type: 'Adolescent Residential',
                category: 'rtc',
                programCategory: 'Residential Treatment Centers (RTC)',
                levelOfCare: 'Residential treatment center for adolescent males with substance use and co-occurring mental health disorders.',
                features: [
                    'Dual-Diagnosis Expertise: Clinical program designed specifically for adolescents',
                    'Detox to Residential Continuum: Safe, medically supervised detox followed by structured treatment',
                    'Family Restoration Focus: Programming emphasizes rebuilding relationships',
                    'Faith-Informed Recovery: Christian values and faith-based elements available',
                    'Individualized Treatment Plans: Customized care designed to uncover strengths',
                    'Founders with Lived Experience: The Fikes family brings personal understanding'
                ],
                contact: {
                    contactPerson: 'Bridget Norris',
                    phone: '662-667-1832',
                    address: '8 Co Rd 362, Oxford, MS 38655',
                    website: 'https://www.stonewaterrecovery.com'
                }
            },
            {
                id: 'catalyst-rtc',
                name: 'Catalyst Residential Treatment Center',
                location: 'Utah',
                type: 'Adolescent Residential',
                category: 'rtc',
                programCategory: 'Residential Treatment Centers (RTC)',
                levelOfCare: 'Holistic residential treatment for boys focusing on balance in six core elements.',
                features: [
                    'Minimum 15 hours of therapeutic treatment weekly',
                    '3 hours of individual or family sessions',
                    '5 hours of group therapy',
                    '7-8 hours of experiential recreation',
                    'The Seven Challenges Program for drug use and addictive behaviors',
                    '10-12 hours of experiential activities weekly',
                    'Relationship-based program fostering positive relationships',
                    'Leadership skills development',
                    'Core academic subjects plus electives'
                ],
                contact: {
                    contactPerson: 'Jo Mitchell – Admissions Coordinator',
                    phone: '951.252.5103',
                    email: 'jo@catalystrtc.com',
                    website: 'www.catalystrtc.com'
                }
            },
            {
                id: 'turnbridge',
                name: 'Turnbridge Residential',
                location: 'New Haven, CT',
                type: 'Young Adult Residential',
                category: 'rtc',
                programCategory: 'Residential Treatment Centers (RTC)',
                levelOfCare: 'Long-term residential program for young adults with substance use and co-occurring disorders.',
                features: [
                    'Phase I: Mental Health & Addiction Treatment – Structured therapy, recreation, wellness',
                    'Phase II: Life Skills & Planning – Residents pursue education, employment readiness',
                    'Phase III: Sober Living – Clients begin college, work, or volunteer activities',
                    'Duration: 12+ months recommended for lasting change',
                    'Vocational Support: Career development and educational planning',
                    'Community Integration: Real-world skill application'
                ],
                contact: {
                    contactPerson: 'Beth Legacki',
                    phone: '512.921.3533',
                    address: '189 Orange Street, New Haven, CT 06510',
                    email: 'blegacki@turnbridge.com',
                    website: 'www.turnbridge.com'
                }
            },
            {
                id: 'insight-program',
                name: 'The Insight Program',
                location: 'Tampa, FL',
                type: 'IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Intensive outpatient substance use treatment program for adolescents and young adults.',
                features: [
                    'Free Evaluations: No-cost substance use evaluations for clients and families',
                    'Weekly IOP Sessions: Five treatment sessions per week',
                    '12-Step Meetings: Weekly youth-focused 12-step support',
                    'Family Integration: Weekly family counseling and support',
                    'Two-Year Aftercare: Includes follow-up counseling and group access',
                    'School & Community Engagements: Education on youth substance use'
                ],
                contact: {
                    contactPerson: 'Adam Schwartz',
                    phone: '470-505-9786',
                    address: '13944 Lynmar Blvd, Tampa, FL 33626',
                    website: 'https://theinsightprogram.com/'
                }
            },
            {
                id: 'greater-nashua',
                name: 'Greater Nashua Mental Health',
                location: 'Nashua, NH',
                type: 'IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Adolescent Intensive Outpatient Program for teens with substance use and co-occurring disorders.',
                features: [
                    'IOP Structure: Group therapy, individual therapy, family involvement',
                    'Psychiatric Services: Access to in-house or referred psychiatric practitioners',
                    'Whole-Person Coordination: Collaboration with schools, doctors, and service providers',
                    'Recovery Coaching: Helps adolescents connect with long-term recovery resources'
                ],
                contact: {
                    address: '15 Prospect Street, Nashua, NH 03060',
                    phone: '603.401.1597',
                    website: 'https://gnmhc.org/'
                }
            },
            {
                id: 'directions-behavioral',
                name: 'Directions Behavioral Health',
                location: 'Nashua, NH',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Outpatient and partial hospitalization program serving teens and young adults.',
                features: [
                    'IOP: 3 hours per day of group therapy and psychiatric services',
                    'PHP: 5 hours per day of clinical programming',
                    'Family Work: Ongoing parent engagement and clinical involvement',
                    'Insurance Accepted: Covered by most commercial health plans'
                ],
                contact: {
                    address: '25 Technology Way, Nashua, NH 03060',
                    phone: '603.880.8188',
                    website: 'https://www.directionbehavioralhealth.com/'
                }
            },
            // WILDERNESS THERAPY
            {
                id: 'turning-winds',
                name: 'Turning Winds',
                location: 'Troy, MT',
                type: 'Wilderness/Residential',
                category: 'wilderness',
                programCategory: 'Wilderness Therapy / Hybrid Programs',
                levelOfCare: 'Residential treatment center and therapeutic boarding school for adolescents ages 13–18.',
                features: [
                    'Small Community: Maximum of 45 students with average stay of 12 months',
                    'Comprehensive Diagnosis: Addresses ADHD, depression, anxiety, substance use, eating disorders',
                    '5 Pillars of Change: Character, health, outdoor education, therapeutic success, academics',
                    'Outdoor Adventure Therapy: Wilderness-based experiential education',
                    'Clinical Services: Individual, group, and family therapy',
                    'Accredited Academics: IEP support and personalized education'
                ],
                contact: {
                    contactPerson: 'Eric Losche – Admission Director',
                    phone: '973.650.8636',
                    address: '31733 S Fork Yaak Rd, Troy, MT 59935',
                    website: 'https://www.turningwinds.com/'
                }
            },
            
            // THERAPEUTIC BOARDING SCHOOLS
            {
                id: 'in-balance-academy',
                name: 'In Balance Academy',
                location: 'Tucson, AZ',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Therapeutic boarding school for adolescent males combining recovery, academics, and character development.',
                features: [
                    'Individualized Academics: Accredited education aligned with student strengths',
                    'Family Systems Focus: Therapy and education to rebuild relationships',
                    'Service-Oriented Culture: Students engage in acts of service',
                    'Staff Mentorship: Clinicians and mentors help students identify purpose',
                    'Emphasis on Community: Shared goals and daily rituals'
                ],
                contact: {
                    contactPerson: 'Tiffany – Director of Admissions',
                    phone: '520.653.8716',
                    address: '6107 E Grant Rd, Tucson, AZ 85712'
                }
            },
            {
                id: 'crossroads-academy',
                name: 'Crossroads Academy',
                location: 'Ogden, UT',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Therapeutic program and recovery residence for adolescent boys ages 14–18.',
                features: [
                    'Individual Therapy: Weekly 1:1 sessions in informal environments',
                    'Group Therapy: Peer process groups offering support and accountability',
                    'Family Therapy: Weekly sessions and coordination with home therapists',
                    'Recovery Work: 3 hours per week of substance use counseling',
                    'Academic Planning: Credit recovery and individualized learning plans',
                    'Holistic Focus: Incorporates outdoor recreation and mentorship'
                ],
                contact: {
                    contactPerson: 'Sam Dahlin – Co-Owner',
                    phone: '801.369.0238',
                    address: '195 25th Street, Suite 300, Ogden, UT 84401',
                    website: 'www.crossroadsrtc.com'
                }
            },
            {
                id: 'mountain-springs',
                name: 'Mountain Springs Preparatory Academy',
                location: 'Cedar City, UT',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Step-down boarding school for teens transitioning from higher levels of care.',
                features: [
                    'Real-Life Practice: Co-ed milieu, community jobs, and unsupervised outings',
                    'Solution-Focused Mentoring: Emphasizes learning from natural consequences',
                    'Individualized MAPP Plans: Custom goals across academic, personal, family domains',
                    'Parental Reengagement: Empowers families to re-take the parenting role',
                    'College & Career Prep: Forward planning with clinical wraparound care'
                ],
                contact: {
                    contactPerson: 'Shawnale Wilson – Admissions Director',
                    phone: '435.592.3220',
                    email: 'swilson@mountainspringsprep.com',
                    address: '1454 S Campus Dr, Cedar City, UT 84720'
                }
            },
            {
                id: 'grove-school',
                name: 'The Grove School',
                location: 'Madison, CT',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Therapeutic boarding and day school for adolescents ages 11–18.',
                features: [
                    'Individualized Treatment: Support for behavioral, academic, emotional challenges',
                    'Year-Round Education: 12-month academic schedule with four 2-week breaks',
                    'Holistic Model: Clinical therapy, residential life, and extracurriculars',
                    'Academic Supports: Small classes and individualized learning',
                    'Long-Term Planning: Prepares students for healthy transition into adulthood'
                ],
                contact: {
                    phone: '203.245.2778',
                    address: '175 Copse Rd, Madison, CT 06443',
                    website: 'http://www.groveschool.org/'
                }
            },
            {
                id: 'maple-hall-academy',
                name: 'Maple Hall Academy',
                location: 'Lexington, VA',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Therapeutic boarding school for students in grades 5–9.',
                features: [
                    'Therapeutic Curriculum: Integrates clinical, academic, and social-emotional learning',
                    'Expressive Arts Therapy: Ceramics, equine, and creative expression',
                    'Individualized Academics: Personalized college-prep instruction',
                    'Community Involvement: Encourages family and school reintegration',
                    'Beautiful Campus: Swimming pool, soccer field, animal pastures, ceramics studio'
                ],
                contact: {
                    contactPerson: 'Chass Armstrong – Executive Director',
                    phone: '828.747.9294',
                    address: '3111 N Lee Hwy, Lexington, VA 24450',
                    website: 'https://maplehallacademy.com/'
                }
            },
            {
                id: 'black-mountain-academy',
                name: 'Black Mountain Academy',
                location: 'Black Mountain, NC',
                type: 'Therapeutic Boarding School',
                category: 'tbs',
                programCategory: 'Therapeutic Boarding Schools',
                levelOfCare: 'Therapeutic boarding school for adolescent males with Level 1 autism.',
                features: [
                    'Inquiry-Based Academics: Rigorous curriculum adapted for learning differences',
                    'Six Core Competencies: Social skills, wellness, executive functioning, independence',
                    'Real-World Preparation: Financial literacy, hygiene routines, community skills',
                    'Autism-Specific Supports: Integrated emotional regulation strategies',
                    'Health & Wellness: Exercise, sleep hygiene, nutrition, stress management',
                    'Independent Living Skills: Daily living skills and self-regulation'
                ],
                contact: {
                    phone: '828.243.6165',
                    address: 'PO Box 1236, Black Mountain, NC 28711',
                    website: 'www.theblackmountainacademy.com'
                }
            },
            
            // DISCOVERY MOOD & ANXIETY PROGRAMS
            {
                id: 'discovery-dade-city',
                name: 'Discovery Mood & Anxiety',
                location: 'Dade City, FL',
                type: 'Residential/PHP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Residential and PHP programs for adolescents ages 11–17 with depression, anxiety, trauma.',
                features: [
                    'Residential Treatment: 24/7 therapeutic support in home-like setting',
                    'PHP: Day program with therapy, group, and academic support',
                    'CBT, DBT & Experiential Therapy: Weekly evidence-based sessions',
                    'Psychiatric Oversight: Medication management and evaluation',
                    'Family Integration: Weekly therapy and support groups'
                ],
                contact: {
                    phone: '(954) 825-9887',
                    website: 'www.discoverymood.com'
                }
            },
            {
                id: 'discovery-maitland',
                name: 'Discovery Mood & Anxiety',
                location: 'Maitland, FL',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'PHP and IOP services for adolescents ages 11–17 near Orlando.',
                features: [
                    'PHP: Structured day program with therapy and academics',
                    'IOP: Afternoon programming for step-down or less acute needs',
                    'Virtual Services: Optional for teens transitioning home',
                    'Psychiatric Services: Medication and evaluation included',
                    'Family Therapy: In-person and virtual family participation'
                ],
                contact: {
                    phone: '(954) 825-9887',
                    website: 'www.discoverymood.com'
                }
            },
            {
                id: 'discovery-tampa-orlando',
                name: 'Discovery Mood & Anxiety',
                location: 'Tampa-Orlando Region, FL',
                type: 'Residential/PHP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Boarded PHP and Residential Treatment for teens with mood and anxiety disorders.',
                features: [
                    'Residential: On-site housing and 24/7 support',
                    'PHP: Intensive therapeutic programming with educational components',
                    'IOP services offered as well',
                    'Specialized Tracks: Trauma, anxiety, and co-occurring presentations',
                    'Family Involvement: Required family therapy and parent support groups',
                    'Psychiatric & Medical Care: On-site assessments and medication management'
                ],
                contact: {
                    phone: '(954) 825-9887',
                    website: 'www.discoverymood.com'
                }
            },
            
            // HIGH FOCUS TREATMENT CENTERS
            {
                id: 'high-focus-cherry-hill',
                name: 'High Focus Treatment Centers',
                location: 'Cherry Hill, NJ',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Adolescent PHP and IOP programs for ages 10–18.',
                features: [
                    'PHP: Full-day structured care with integrated academic support',
                    'IOP: After-school mental health support',
                    'Weekly Psychiatry: Clients receive weekly psychiatric oversight',
                    'DBT-Focused: Skills for emotional regulation and distress tolerance'
                ],
                contact: {
                    email: 'aszuminski@highfocuscenters.com',
                    website: 'https://www.highfocuscenters.com/'
                }
            },
            {
                id: 'high-focus-branchburg',
                name: 'High Focus Treatment Centers',
                location: 'Branchburg, NJ',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Adolescent PHP and IOP programs for ages 10–18.',
                features: [
                    'PHP: Full-day structured care with integrated academic support',
                    'IOP: After-school mental health support',
                    'Weekly Psychiatry: Clients receive weekly psychiatric oversight',
                    'DBT-Focused: Skills for emotional regulation'
                ],
                contact: {
                    website: 'https://www.highfocuscenters.com/'
                }
            },
            {
                id: 'high-focus-lawrenceville',
                name: 'High Focus Treatment Centers',
                location: 'Lawrenceville, NJ',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Adolescent PHP and IOP programs for ages 10–18.',
                features: [
                    'PHP: Full-day structured care with integrated academic support',
                    'IOP: After-school mental health support',
                    'Weekly Psychiatry: Clients receive weekly psychiatric oversight',
                    'DBT-Focused: Skills for emotional regulation'
                ],
                contact: {
                    website: 'https://www.highfocuscenters.com/'
                }
            },
            {
                id: 'high-focus-parsippany',
                name: 'High Focus Treatment Centers',
                location: 'Parsippany, NJ',
                type: 'PHP/IOP',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Adolescent PHP and IOP programs for ages 10–18.',
                features: [
                    'PHP: Full-day structured care with integrated academic support',
                    'IOP: After-school mental health support',
                    'Weekly Psychiatry: Clients receive weekly psychiatric oversight',
                    'DBT-Focused: Skills for emotional regulation'
                ],
                contact: {
                    website: 'https://www.highfocuscenters.com/'
                }
            },
            
            // ROSECRANCE LOCATIONS
            {
                id: 'rosecrance-frankfort',
                name: 'Rosecrance',
                location: 'Frankfort, IL',
                type: 'Outpatient/Residential',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Outpatient and/or residential substance use and mental health treatment for adolescents.',
                features: [
                    'IOP Services: Structured programming while teens reside at home',
                    'PHP or Residential: Full-day or on-site therapeutic living',
                    'Family-Focused Treatment: Group, individual, and family therapy',
                    'Recovery Education: Skills training and relapse prevention'
                ],
                contact: {
                    phone: '815.391.1000',
                    website: 'https://rosecrance.org/'
                }
            },
            {
                id: 'rosecrance-chicago',
                name: 'Rosecrance',
                location: 'Chicago, IL',
                type: 'Outpatient/Residential',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Outpatient and/or residential substance use and mental health treatment.',
                features: [
                    'IOP Services: Structured programming while teens reside at home',
                    'PHP or Residential: Full-day or on-site therapeutic living',
                    'Family-Focused Treatment: Group, individual, and family therapy',
                    'Recovery Education: Skills training and relapse prevention'
                ],
                contact: {
                    phone: '815.391.1000',
                    website: 'https://rosecrance.org/'
                }
            },
            {
                id: 'rosecrance-mchenry',
                name: 'Rosecrance',
                location: 'McHenry County, IL',
                type: 'Outpatient/Residential',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Outpatient and/or residential substance use and mental health treatment.',
                features: [
                    'IOP Services: Structured programming while teens reside at home',
                    'PHP or Residential: Full-day or on-site therapeutic living',
                    'Family-Focused Treatment: Group, individual, and family therapy',
                    'Recovery Education: Skills training and relapse prevention'
                ],
                contact: {
                    phone: '815.391.1000',
                    website: 'https://rosecrance.org/'
                }
            },
            {
                id: 'rosecrance-rockford',
                name: 'Rosecrance Griffin-Williamson Campus',
                location: 'Rockford, IL',
                type: 'Outpatient/Residential',
                category: 'php-iop',
                programCategory: 'PHP / IOP Programs',
                levelOfCare: 'Outpatient and/or residential substance use and mental health treatment.',
                features: [
                    'IOP Services: Structured programming while teens reside at home',
                    'PHP or Residential: Full-day or on-site therapeutic living',
                    'Family-Focused Treatment: Group, individual, and family therapy',
                    'Recovery Education: Skills training and relapse prevention'
                ],
                contact: {
                    phone: '815.391.1000',
                    website: 'https://rosecrance.org/'
                }
            },
            
            // FRIENDSHIP CIRCLE PROGRAMS
            {
                id: 'friendship-circle-fort-lauderdale',
                name: 'Friendship Circle – Teen Scene',
                location: 'Fort Lauderdale, FL',
                type: 'Social Program',
                category: 'athome',
                programCategory: 'Community Support Programs',
                levelOfCare: 'Social engagement group for teens with special needs.',
                features: [
                    'Teen Scene: Bi-monthly Sunday meetups (3:00pm – 4:30pm)',
                    'Mentor Pairings: Teen volunteers partner with participants',
                    'Social Skill Building: Structured, supportive interactions',
                    'Parent Engagement: Mom\'s Night Out community events',
                    'Ages 10-18: Designed for special teens needing social connection'
                ],
                contact: {
                    phone: '754.800.1770',
                    website: 'https://friendshipfl.org/',
                    programInfo: 'https://friendshipfl.org/our-programs#teen-scene'
                }
            },
            {
                id: 'friendship-circle-hallandale',
                name: 'Friendship Circle',
                location: 'Hallandale, FL',
                type: 'Social Program',
                category: 'athome',
                programCategory: 'Community Support Programs',
                levelOfCare: 'Community-based social and recreational program for children and teens with developmental disabilities.',
                features: [
                    'Inclusive Activities: Monthly meetups, crafts, sports, and games',
                    'One-on-One Friendships: Peer matching for personal growth',
                    'Parent Support: Occasional gatherings and resources'
                ],
                contact: {
                    website: 'https://www.friendshipcirclehallandale.org/'
                }
            },
            {
                id: 'friendship-circle-parkland',
                name: 'Friendship Circle',
                location: 'Parkland/North Broward, FL',
                type: 'Social Program',
                category: 'athome',
                programCategory: 'Community Support Programs',
                levelOfCare: 'Friendship-based programming for teens with special needs.',
                features: [
                    'Volunteer-Led Hangouts: Supervised by program directors',
                    'Jewish Holiday Events: Faith-aligned community building',
                    'Community Integration: Inclusive Shabbat dinners and more'
                ],
                contact: {
                    website: 'https://www.fcpb.org/'
                }
            },
            {
                id: 'friendship-circle-miami',
                name: 'Friendship Circle',
                location: 'Miami, FL',
                type: 'Social Program',
                category: 'athome',
                programCategory: 'Community Support Programs',
                levelOfCare: 'Teen social group and family community programming rooted in Jewish values.',
                features: [
                    'Weekly Gatherings: Social groups and mentorship pairings',
                    'Sensory Events: Music, art, games designed for accessibility',
                    'Family Support: Educational and holiday family programming'
                ],
                contact: {
                    website: 'https://friendshipcirclemiami.org/'
                }
            }
        ];
        
        // State management
        let selectedPrograms = [];
        let documentType = 'options';
        let currentFilter = 'all';
        let currentPreviewProgram = null;
        let draggedItem = null;
        
        // Helpers
        function normalizeUrl(url) {
            if (!url) return '';
            const trimmed = String(url).trim();
            if (!trimmed) return '';
            if (/^https?:\/\//i.test(trimmed)) return trimmed;
            if (/^www\./i.test(trimmed)) return `https://${trimmed}`;
            try {
                // If it's a bare domain like example.com
                const hasDot = trimmed.includes('.') && !trimmed.includes(' ');
                return hasDot ? `https://${trimmed}` : trimmed;
            } catch { return trimmed; }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderPrograms();
            
            // Search functionality (combined with active filter)
            document.getElementById('searchBox').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.program-card');
                cards.forEach(card => {
                    const program = programs.find(p => p.id === card.dataset.id);
                    const matchesSearch = `${program.name} ${program.location} ${program.type}`.toLowerCase().includes(searchTerm);
                    const matchesFilter = (currentFilter === 'all' || program.category === currentFilter);
                    card.style.display = (matchesSearch && matchesFilter) ? 'block' : 'none';
                });
            });
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('previewModal');
                if (event.target == modal) {
                    closePreview();
                }
            }
        });
        
        // Set document type
        function setDocumentType(type, el) {
            documentType = type;
            
            // Update button states
            document.querySelectorAll('.doc-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (el) el.classList.add('active');
            
            // Update UI based on type
            const selectedTitle = document.getElementById('selectedTitle');
            
            if (type === 'plans') {
                selectedTitle.textContent = 'Selected Program (Choose 1)';
                
                // If more than one selected, keep only the first
                if (selectedPrograms.length > 1) {
                    selectedPrograms = [selectedPrograms[0]];
                    updateSelectionPanel();
                    renderPrograms();
                }
            } else {
                selectedTitle.textContent = 'Selected Programs (Drag to reorder)';
            }
        }
        
        // Filter programs
    function filterPrograms(category, el) {
            currentFilter = category;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (el) el.classList.add('active');
            
            // Filter cards
            const cards = document.querySelectorAll('.program-card');
            cards.forEach(card => {
                const program = programs.find(p => p.id === card.dataset.id);
        const searchTerm = document.getElementById('searchBox').value.toLowerCase();
        const matchesFilter = (category === 'all' || program.category === category);
        const matchesSearch = `${program.name} ${program.location} ${program.type}`.toLowerCase().includes(searchTerm);
        card.style.display = (matchesFilter && matchesSearch) ? 'block' : 'none';
            });
        }
        
        // Render programs
        function renderPrograms() {
            const grid = document.getElementById('programGrid');
            grid.innerHTML = '';
            
            programs.forEach(program => {
                const card = document.createElement('div');
                card.className = 'program-card';
                card.dataset.id = program.id;
                
                const isSelected = selectedPrograms.some(p => p.id === program.id);
                if (isSelected) {
                    card.classList.add('primary');
                }
                
                card.innerHTML = `
                    <button class="program-info-btn" onclick="openPreview('${program.id}', event)" title="View Details">i</button>
                    <div class="program-name">${program.name}</div>
                    <div class="program-location">${program.location}</div>
                    <div class="program-type">${program.type}</div>
                    ${isSelected ? '<div class="program-badge">SELECTED</div>' : ''}
                `;
                
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('program-info-btn')) {
                        handleProgramClick(program, card);
                    }
                });
                grid.appendChild(card);
            });
        }
        
        // Handle program clicks
        function handleProgramClick(program, card) {
            const isSelected = selectedPrograms.some(p => p.id === program.id);
            
            if (isSelected) {
                // Remove from selection
                selectedPrograms = selectedPrograms.filter(p => p.id !== program.id);
                card.classList.remove('primary');
                const badge = card.querySelector('.program-badge');
                if (badge) badge.remove();
            } else {
                // Add to selection
                if (documentType === 'plans' && selectedPrograms.length >= 1) {
                    // For plans, replace the existing selection
                    selectedPrograms = [program];
                    // Update all cards
                    renderPrograms();
                } else {
                    selectedPrograms.push(program);
                    card.classList.add('primary');
                    
                    const badge = document.createElement('div');
                    badge.className = 'program-badge';
                    badge.textContent = 'SELECTED';
                    card.appendChild(badge);
                }
            }
            
            updateSelectionPanel();
        }
        
        // Open preview modal
        function openPreview(programId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const program = programs.find(p => p.id === programId);
            if (!program) return;
            
            currentPreviewProgram = program;
            const modal = document.getElementById('previewModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalAddBtn = document.getElementById('modalAddBtn');
            
            // Update modal title
            modalTitle.textContent = `${program.name} - ${program.location}`;
            
            // Generate modal content
            let content = `
                <div class="preview-section">
                    <h3>Program Type</h3>
                    <p>${program.type}</p>
                    <p><strong>Category:</strong> ${program.programCategory}</p>
                </div>
                
                <div class="preview-section">
                    <h3>Level of Care & Services</h3>
                    <p>${program.levelOfCare}</p>
                </div>
                
                <div class="preview-section">
                    <h3>Program Features</h3>
                    <ul class="preview-features">
            `;
            
            program.features.forEach(feature => {
                const parts = feature.split(':');
                if (parts.length > 1) {
                    content += `<li><strong>${parts[0]}:</strong>${parts[1]}</li>`;
                } else {
                    content += `<li>${feature}</li>`;
                }
            });
            
            content += `
                    </ul>
                </div>
                
                <div class="preview-section">
                    <h3>Contact Information</h3>
                    <div class="preview-contact">
            `;
            
            if (program.contact.phone) {
                content += `<div><strong>Phone:</strong> ${program.contact.phone}</div>`;
            }
            if (program.contact.website) {
                const w = normalizeUrl(program.contact.website);
                const label = program.contact.website;
                content += `<div><strong>Website:</strong> <a href="${w}" target="_blank" rel="noopener">${label}</a></div>`;
            }
            if (program.contact.email) {
                content += `<div><strong>Email:</strong> ${program.contact.email}</div>`;
            }
            if (program.contact.address) {
                content += `<div><strong>Address:</strong> ${program.contact.address}</div>`;
            }
            
            content += `
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = content;
            
            // Update add button state
            const isSelected = selectedPrograms.some(p => p.id === programId);
            if (isSelected) {
                modalAddBtn.textContent = 'Remove from Selection';
                modalAddBtn.classList.add('selected');
            } else {
                modalAddBtn.textContent = 'Add to Selection';
                modalAddBtn.classList.remove('selected');
            }
            
            // Show modal
            modal.style.display = 'block';
        }
        
        // Close preview modal
        function closePreview() {
            const modal = document.getElementById('previewModal');
            modal.style.display = 'none';
            currentPreviewProgram = null;
        }
        
        // Toggle program from preview
        function toggleFromPreview() {
            if (!currentPreviewProgram) return;
            
            const isSelected = selectedPrograms.some(p => p.id === currentPreviewProgram.id);
            
            if (isSelected) {
                // Remove from selection
                selectedPrograms = selectedPrograms.filter(p => p.id !== currentPreviewProgram.id);
            } else {
                // Add to selection
                if (documentType === 'plans' && selectedPrograms.length >= 1) {
                    selectedPrograms = [currentPreviewProgram];
                } else {
                    selectedPrograms.push(currentPreviewProgram);
                }
            }
            
            // Update UI
            updateSelectionPanel();
            renderPrograms();
            
            // Update modal button
            const modalAddBtn = document.getElementById('modalAddBtn');
            if (!isSelected) {
                modalAddBtn.textContent = 'Remove from Selection';
                modalAddBtn.classList.add('selected');
            } else {
                modalAddBtn.textContent = 'Add to Selection';
                modalAddBtn.classList.remove('selected');
            }
        }
        
        // Update selection panel with drag and drop
        function updateSelectionPanel() {
            const selectedList = document.getElementById('selectedList');
            
            if (selectedPrograms.length > 0) {
                selectedList.innerHTML = selectedPrograms.map((p, index) => `
                    <div class="selected-program" draggable="true" data-id="${p.id}" data-index="${index}">
                        <span class="drag-handle">⋮⋮</span>
                        <span style="flex: 1;">${p.name} - ${p.location}</span>
                        <div class="program-order-controls">
                            <button class="order-btn" onclick="moveProgram(${index}, 'up')" ${index === 0 ? 'disabled' : ''}>↑</button>
                            <button class="order-btn" onclick="moveProgram(${index}, 'down')" ${index === selectedPrograms.length - 1 ? 'disabled' : ''}>↓</button>
                            <button class="remove-btn" onclick="removeProgram('${p.id}')">×</button>
                        </div>
                    </div>
                `).join('');
                
                // Add drag and drop event listeners
                const items = selectedList.querySelectorAll('.selected-program');
                items.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragenter', handleDragEnter);
                    item.addEventListener('dragleave', handleDragLeave);
                });
            } else {
                selectedList.innerHTML = '<div class="empty-state">Click programs to add to document</div>';
            }
            
            // Enable/disable generate button
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = selectedPrograms.length === 0;
        }
        
        // Drag and drop handlers
        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }
        
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // Remove all drag-over classes
            const items = document.querySelectorAll('.selected-program');
            items.forEach(item => {
                item.classList.remove('drag-over');
            });
        }
        
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }
        
        function handleDragEnter(e) {
            this.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedItem !== this) {
                const draggedIndex = parseInt(draggedItem.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                // Reorder the array
                const [removed] = selectedPrograms.splice(draggedIndex, 1);
                selectedPrograms.splice(targetIndex, 0, removed);
                
                // Update the UI
                updateSelectionPanel();
            }
            
            return false;
        }
        
        // Move program up or down
        function moveProgram(index, direction) {
            if (direction === 'up' && index > 0) {
                [selectedPrograms[index], selectedPrograms[index - 1]] = 
                [selectedPrograms[index - 1], selectedPrograms[index]];
            } else if (direction === 'down' && index < selectedPrograms.length - 1) {
                [selectedPrograms[index], selectedPrograms[index + 1]] = 
                [selectedPrograms[index + 1], selectedPrograms[index]];
            }
            updateSelectionPanel();
        }
        
        // Remove program
        function removeProgram(programId) {
            selectedPrograms = selectedPrograms.filter(p => p.id !== programId);
            updateSelectionPanel();
            renderPrograms();
        }
        
        // Mode selection functions
        function selectMode(mode) {
            const quickModeBtn = document.getElementById('quickModeBtn');
            const guidedModeBtn = document.getElementById('guidedModeBtn');
            const quickModePanel = document.getElementById('quickModePanel');
            const guidedModePanel = document.getElementById('guidedModePanel');
            
            if (mode === 'quick') {
                quickModeBtn.style.background = 'rgba(255,255,255,0.2)';
                quickModeBtn.style.color = 'white';
                quickModeBtn.style.border = '2px solid white';
                quickModeBtn.classList.add('active');
                
                guidedModeBtn.style.background = 'white';
                guidedModeBtn.style.color = '#0066cc';
                guidedModeBtn.style.border = 'none';
                guidedModeBtn.classList.remove('active');
                
                quickModePanel.style.display = 'block';
                guidedModePanel.style.display = 'none';
            } else {
                guidedModeBtn.style.background = 'rgba(255,255,255,0.2)';
                guidedModeBtn.style.color = 'white';
                guidedModeBtn.style.border = '2px solid white';
                guidedModeBtn.classList.add('active');
                
                quickModeBtn.style.background = 'white';
                quickModeBtn.style.color = '#0066cc';
                quickModeBtn.style.border = 'none';
                quickModeBtn.classList.remove('active');
                
                quickModePanel.style.display = 'none';
                guidedModePanel.style.display = 'block';
            }
        }
        
        // AI-powered document generation from pasted content
        async function generateFromWebsite() {
            const programInfo = document.getElementById('quickProgramInfo').value;
            const clientName = document.getElementById('quickClientName').value;
            const statusDiv = document.getElementById('quickModeStatus');
            
            if (!programInfo) {
                alert('Please paste program information or use the Chrome extension!');
                return;
            }
            
            if (!clientName) {
                alert('Please enter client name!');
                return;
            }
            
            // Check if API key is configured
            if (appConfig.openaiApiKey === 'YOUR_OPENAI_API_KEY') {
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#fff3cd';
                statusDiv.style.color = '#856404';
                statusDiv.innerHTML = `
                    <strong>⚠️ API Key Not Configured</strong><br>
                    <p>To use AI analysis, you need to add your OpenAI API key:</p>
                    <ol style="margin: 10px 0;">
                        <li>Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></li>
                        <li>Edit line 1353 in AppsCode.html</li>
                        <li>Replace YOUR_OPENAI_API_KEY with your actual key</li>
                    </ol>
                    <p><strong>Alternative:</strong> You can manually format the pasted content into a document.</p>
                    <button onclick="generateManualDocument('${clientName.replace(/'/g, "\\'")}')" style="background: #0066cc; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Generate Manual Document</button>
                `;
                return;
            }
            
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#f0f8ff';
            statusDiv.style.color = '#0066cc';
            statusDiv.innerHTML = '🔄 Analyzing program information with AI...';
            
            try {
                // Call OpenAI API to analyze the pasted content
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${appConfig.openaiApiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: `You are an expert at analyzing treatment program information and creating professional referral documents. Extract and format the following information from the provided text:
                                - Program Name
                                - Location (City, State)
                                - Phone Number
                                - Website
                                - Level of Care (RTC, PHP, IOP, etc.)
                                - Age Range
                                - Gender Served
                                - Insurance Accepted
                                - Specialties and Treatment Approaches
                                - Duration/Length of Stay
                                - Accreditations
                                - Additional Features
                                
                                Format the response as a JSON object with these fields. If information is not available, use "Not specified" as the value.`
                            },
                            {
                                role: 'user',
                                content: programInfo
                            }
                        ],
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                const programData = JSON.parse(data.choices[0].message.content);
                
                // Generate document with extracted information
                generateQuickModeDocument(clientName, programData);
                
                statusDiv.style.background = '#d4f4dd';
                statusDiv.style.color = '#28a745';
                statusDiv.innerHTML = '✅ Document generated successfully!';
                
            } catch (error) {
                statusDiv.style.background = '#ffe6e6';
                statusDiv.style.color = '#dc3545';
                statusDiv.innerHTML = `❌ Error: ${error.message}. Please check your API key or try manual entry.`;
            }
        }
        
        // Generate document from AI-extracted data
        function generateQuickModeDocument(clientName, programData) {
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Treatment Options - ${clientName}</title>
                    <style>
                        /* Same styles as regular generateDocument function */
                        @page { size: letter; margin: 0.5in; }
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                        .letterhead { border-bottom: 3px solid #0066cc; padding-bottom: 10px; margin-bottom: 20px; }
                        /* ... rest of styles ... */
                    </style>
                </head>
                <body>
                    <div class="letterhead">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center;">
                                <div style="width: 50px; height: 50px; background: #0066cc; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin-right: 15px;">F</div>
                                <div>
                                    <h1 style="margin: 0; color: #0066cc; font-size: 24px;">Family First</h1>
                                    <p style="margin: 0; font-size: 14px; color: #666;">ADOLESCENT SERVICES</p>
                                </div>
                            </div>
                            <div style="text-align: right; font-size: 14px; color: #666;">
                                ${date}
                            </div>
                        </div>
                    </div>
                    
                    <h2 style="color: #0066cc;">TREATMENT RECOMMENDATION</h2>
                    <p><strong>Client:</strong> ${clientName}</p>
                    
                    <div style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
                        <h3 style="color: #0066cc; margin-top: 0;">${programData['Program Name'] || 'Program Name Not Specified'}</h3>
                        <p><strong>Location:</strong> ${programData['Location'] || 'Not specified'}</p>
                        <p><strong>Phone:</strong> ${programData['Phone Number'] || 'Not specified'}</p>
                        <p><strong>Website:</strong> ${programData['Website'] || 'Not specified'}</p>
                        <p><strong>Level of Care:</strong> ${programData['Level of Care'] || 'Not specified'}</p>
                        <p><strong>Age Range:</strong> ${programData['Age Range'] || 'Not specified'}</p>
                        <p><strong>Gender Served:</strong> ${programData['Gender Served'] || 'Not specified'}</p>
                        <p><strong>Insurance:</strong> ${programData['Insurance Accepted'] || 'Not specified'}</p>
                        <p><strong>Treatment Duration:</strong> ${programData['Duration/Length of Stay'] || 'Not specified'}</p>
                        <p><strong>Accreditations:</strong> ${programData['Accreditations'] || 'Not specified'}</p>
                        
                        <h4 style="color: #0066cc;">Specialties & Treatment Approaches:</h4>
                        <p>${programData['Specialties and Treatment Approaches'] || 'Not specified'}</p>
                        
                        <h4 style="color: #0066cc;">Additional Features:</h4>
                        <p>${programData['Additional Features'] || 'Not specified'}</p>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #0066cc; text-align: center; color: #666;">
                        <p style="margin: 0;">8737 Dunwoody Place | Suite 100 | Atlanta, Georgia 30350</p>
                        <p style="margin: 5px 0;">Office: 770.407.0768 ext 2 | Fax: 770.407.0516</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }
        
        // Listen for messages from Chrome extension
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'PROGRAM_INFO_EXTRACTED') {
                // Auto-fill the Quick Mode textarea with extracted content
                document.getElementById('quickProgramInfo').value = event.data.content;
                selectMode('quick'); // Switch to Quick Mode
                document.getElementById('quickModeStatus').style.display = 'block';
                document.getElementById('quickModeStatus').style.background = '#d4f4dd';
                document.getElementById('quickModeStatus').style.color = '#28a745';
                document.getElementById('quickModeStatus').innerHTML = '✅ Content extracted from website! Enter client name and generate document.';
            }
        });
        
        // Generate manual document without AI
        function generateManualDocument(clientName) {
            const programInfo = document.getElementById('quickProgramInfo').value;
            if (!clientName) clientName = document.getElementById('quickClientName').value;
            
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Treatment Information - ${clientName}</title>
                    <style>
                        @page { size: letter; margin: 0.5in; }
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; line-height: 1.6; }
                        .letterhead { border-bottom: 3px solid #0066cc; padding-bottom: 10px; margin-bottom: 20px; }
                        .logo-container { display: flex; justify-content: space-between; align-items: center; }
                        .logo-left { display: flex; align-items: center; }
                        .logo-circle { width: 50px; height: 50px; background: #0066cc; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin-right: 15px; }
                        h1 { margin: 0; color: #0066cc; font-size: 24px; }
                        h2 { color: #0066cc; margin-top: 20px; }
                        .content-box { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #0066cc; text-align: center; color: #666; font-size: 14px; }
                        .program-info { white-space: pre-wrap; font-family: Arial, sans-serif; }
                    </style>
                </head>
                <body>
                    <div class="letterhead">
                        <div class="logo-container">
                            <div class="logo-left">
                                <div class="logo-circle">F</div>
                                <div>
                                    <h1>Family First</h1>
                                    <p style="margin: 0; font-size: 14px; color: #666;">ADOLESCENT SERVICES</p>
                                </div>
                            </div>
                            <div style="text-align: right; font-size: 14px; color: #666;">
                                ${date}
                            </div>
                        </div>
                    </div>
                    
                    <h2>PROGRAM INFORMATION</h2>
                    <p><strong>Client:</strong> ${clientName}</p>
                    
                    <div class="content-box">
                        <h3 style="color: #0066cc; margin-top: 0;">Program Details</h3>
                        <div class="program-info">${programInfo.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                    </div>
                    
                    <div class="footer">
                        <p style="margin: 0;">8737 Dunwoody Place | Suite 100 | Atlanta, Georgia 30350</p>
                        <p style="margin: 5px 0;">Office: 770.407.0768 ext 2 | Fax: 770.407.0516</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 250);
            
            // Update status
            const statusDiv = document.getElementById('quickModeStatus');
            statusDiv.style.background = '#d4f4dd';
            statusDiv.style.color = '#28a745';
            statusDiv.innerHTML = '✅ Manual document generated! The print dialog should appear.';
        }
        
        // Generate document - Professional letterhead format
        function generateDocument() {
            const clientName = document.getElementById('clientName').value;
            
            if (!clientName) {
                alert('Please enter client name!');
                return;
            }
            
            // Use the order as arranged by the user
            const orderedPrograms = [...selectedPrograms];
            
            // Generate document with professional letterhead styling
            let html = `
                <div class="doc-page">
                    <div class="doc-content">
                        <!-- Letterhead Header -->
                        <div class="doc-letterhead">
                            <img src="${LOGO_WEBP}" 
                                 alt="Family First Logo" 
                                 class="doc-letterhead-logo"
                                 style="height: 80px; width: auto; max-width: 160px; margin: 0 auto 15px; display: block; object-fit: contain;">
                            <div class="doc-letterhead-text" style="text-align: center;">
                                <h1>Family First</h1>
                                <p>Adolescent Services</p>
                            </div>
                        </div>
                        

            `;
            
            if (documentType === 'options') {
                // OPTIONS Document Format
                html += `
                    <div class="doc-greeting">Hello,</div>
                    <div class="doc-intro">
                        The FFAS clinical team has formulated a list of recommendations and options to support ${clientName} in continuing care. 
                        Included in the list is: contact information, location, website, and a breakdown of specialties and services provided by each program.
                    </div>
                    <div class="doc-section-header">Aftercare Options:</div>
                `;
            } else {
                // PLANS Document Format
                html += `
                    <div class="doc-greeting">Hello,</div>
                    <div class="doc-intro">
                        Below is ${clientName}'s aftercare plan. Included in this list is: contact information, location, website, 
                        and a breakdown of specialties and services provided by the program.
                    </div>
                    <div class="doc-section-header">Aftercare Plan:</div>
                `;
            }
            
            // Group programs by type if using categories
            let currentCategory = '';
            
            // Add programs in user-arranged order
            orderedPrograms.forEach(program => {
                // Extract demographic info from features or use defaults
                let demographics = '';
                let ageRange = '';
                
                // Look for age and gender info in features
                program.features.forEach(feature => {
                    if (feature.toLowerCase().includes('gender')) {
                        demographics = feature.includes('All') ? 'All-Gender' : feature;
                    }
                    if (feature.toLowerCase().includes('age')) {
                        const ageMatch = feature.match(/(\d+)[\s-–]+(\d+)/);
                        if (ageMatch) {
                            ageRange = `Ages ${ageMatch[1]}–${ageMatch[2]}`;
                        }
                    }
                });
                
                // Build the title line with en dash
                const titleParts = [program.name];
                if (program.type) titleParts.push(program.type);
                const titleBase = titleParts.join(' – ');
                const titleDemo = (demographics || ageRange) ? ` (${[demographics, ageRange].filter(Boolean).join(', ')})` : '';
                
                // Extract services from levelOfCare
                const services = program.levelOfCare.includes('Services:') 
                    ? program.levelOfCare.split('Services:')[1]?.trim() 
                    : 'Clinical Therapy, Psychiatric Support, Dual Diagnosis, Academics, Family Work';
                
                html += `
                    <div class="doc-program">
                        <div class="doc-program-title">${titleBase}${titleDemo}</div>
                        
                        <div class="doc-program-descriptor">
                            <strong>Level of Care:</strong> ${program.type || 'RTC'} | <strong>Services:</strong> ${services}
                        </div>
                        
                        <div class="doc-program-details-heading">Program Details / Differentiating Features:</div>
                        <ul class="doc-program-bullets">
                            ${program.features.map(feature => {
                                // Check if this feature has sub-points (look for specific patterns)
                                if (feature.toLowerCase().includes('family') && feature.toLowerCase().includes('care')) {
                                    return `<li>${feature}
                                        <ul class="doc-sub-bullets">
                                            <li>Weekly family therapy via telehealth</li>
                                            <li>Monthly family weekends on campus</li>
                                            <li>Parent support groups</li>
                                            <li>Structured home visits for reintegration practice</li>
                                        </ul>
                                    </li>`;
                                }
                                return `<li>${feature}</li>`;
                            }).join('')}
                        </ul>
                        
                        <div class="doc-program-details-heading">Contact Information:</div>
                        <div class="doc-contact-section">
                            ${program.contact.phone ? `<strong>Phone:</strong> ${program.contact.phone}<br>` : ''}
                            ${program.contact.website ? (() => { 
                                const w = normalizeUrl(program.contact.website); 
                                return `<strong>Website:</strong> <a href="${w}" target="_blank" rel="noopener">${w}</a>`;
                            })() : ''}
                        </div>
                    </div>
                `;
            });
            
            // Add AT HOME Recommendations if checkbox is checked
            const includeAtHome = document.getElementById('includeAtHome').checked;
            if (includeAtHome && documentType === 'options') {
                html += `
                    <div class="doc-section-header doc-emphasis-section" style="margin-top: 24pt;">
                        AT HOME Recommendation: If extended residential care is not a viable option, below are the clinical recommendations should your son return home.
                    </div>
                    
                    <div class="doc-category-header">PHP Options</div>
                    
                    <!-- Blank mini-cards for manual entry -->
                    <div class="doc-mini-card">
                        <div class="doc-mini-title">___________________________ – PHP, ___________ Location</div>
                        <div class="doc-mini-blurb">________________________________________________________________</div>
                        <div class="doc-mini-contact">
                            <strong>Phone:</strong> ___________________________________<br>
                            <strong>Website:</strong> _________________________________
                        </div>
                    </div>
                    
                    <div class="doc-mini-card">
                        <div class="doc-mini-title">___________________________ – PHP, ___________ Location</div>
                        <div class="doc-mini-blurb">________________________________________________________________</div>
                        <div class="doc-mini-contact">
                            <strong>Phone:</strong> ___________________________________<br>
                            <strong>Website:</strong> _________________________________
                        </div>
                    </div>
                    
                    <div class="doc-category-header">IOP Options</div>
                    
                    <div class="doc-mini-card">
                        <div class="doc-mini-title">___________________________ – IOP, ___________ Location</div>
                        <div class="doc-mini-blurb">________________________________________________________________</div>
                        <div class="doc-mini-contact">
                            <strong>Phone:</strong> ___________________________________<br>
                            <strong>Website:</strong> _________________________________
                        </div>
                    </div>
                    
                    <div class="doc-category-header">Therapeutic Support</div>
                    
                    <div class="doc-mini-card">
                        <div class="doc-mini-title">___________________________ – Individual Therapy</div>
                        <div class="doc-mini-blurb">________________________________________________________________</div>
                        <div class="doc-mini-contact">
                            <strong>Phone:</strong> ___________________________________<br>
                            <strong>Website:</strong> _________________________________
                        </div>
                    </div>
                    
                    <div class="doc-mini-card">
                        <div class="doc-mini-title">___________________________ – Psychiatry</div>
                        <div class="doc-mini-blurb">________________________________________________________________</div>
                        <div class="doc-mini-contact">
                            <strong>Phone:</strong> ___________________________________<br>
                            <strong>Website:</strong> _________________________________
                        </div>
                    </div>
                `;
            }
            
            // Close content div
            html += `
                    </div>
                    
                    <!-- Footer - single line with dot separators -->
                    <div class="doc-footer">
                        700 Village Square Crossing, Unit 101, Palm Beach Gardens, FL 33410 • (561) 328-7370 • familyfirstas.com
                    </div>
                </div>
            `;
            
            // Set the document content
            document.getElementById('documentOutput').innerHTML = html;
            
            // Print the document
            window.print();
            
            // Save to history
            saveToHistory({
                clientName: clientName,
                documentType: documentType,
                programs: selectedPrograms
            });
        }
        
        // ================ ENHANCED FUNCTIONS ================
        
        // Storage Keys
        const STORAGE_KEYS = {
            selectedPrograms: 'aftercare_selected_programs',
            documentHistory: 'aftercare_document_history',
            theme: 'aftercare_theme'
        };
        
        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');
            
            if (isDark) {
                icon.textContent = '☀️';
                text.textContent = 'Light Mode';
                localStorage.setItem(STORAGE_KEYS.theme, 'dark');
            } else {
                icon.textContent = '🌙';
                text.textContent = 'Dark Mode';
                localStorage.setItem(STORAGE_KEYS.theme, 'light');
            }
        }
        
        // Select All Programs
        function selectAllPrograms() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            let toSelect = programs;
            
            if (currentFilter !== 'all') {
                toSelect = toSelect.filter(p => p.category === currentFilter);
            }
            
            toSelect.forEach(program => {
                if (!selectedPrograms.find(p => p.id === program.id)) {
                    selectedPrograms.push(program);
                }
            });
            
            updateSelectedPrograms();
            displayPrograms();
        }
        
        // Clear All Programs
        function clearAllPrograms() {
            selectedPrograms = [];
            updateSelectedPrograms();
            displayPrograms();
        }
        
        // Select by Category
        function selectByCategory() {
            const category = prompt('Enter category (virtual, rtc, tbs, wilderness, php-iop, transitional):');
            if (category) {
                const categoryPrograms = programs.filter(p => p.category === category.toLowerCase());
                categoryPrograms.forEach(program => {
                    if (!selectedPrograms.find(p => p.id === program.id)) {
                        selectedPrograms.push(program);
                    }
                });
                updateSelectedPrograms();
                displayPrograms();
            }
        }
        
        // Compare Programs
        function comparePrograms() {
            if (selectedPrograms.length < 2) {
                alert('Please select at least 2 programs to compare');
                return;
            }
            
            const comparisonView = document.getElementById('comparisonView');
            const content = document.getElementById('comparisonContent');
            
            const comparePrograms = selectedPrograms.slice(0, 3);
            
            content.innerHTML = comparePrograms.map(program => `
                <div class="comparison-column">
                    <h3>${program.name}</h3>
                    <p><strong>Location:</strong> ${program.location}</p>
                    <p><strong>Type:</strong> ${program.type}</p>
                    <p><strong>Level of Care:</strong> ${program.levelOfCare}</p>
                    <h4>Features:</h4>
                    <ul style="font-size: 12px;">
                        ${program.features.slice(0, 5).map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
            
            comparisonView.style.display = 'block';
        }
        
        function closeComparison() {
            document.getElementById('comparisonView').style.display = 'none';
        }
        
        // Document History
        function saveToHistory(documentData) {
            let history = JSON.parse(localStorage.getItem(STORAGE_KEYS.documentHistory) || '[]');
            
            const historyItem = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                clientName: documentData.clientName,
                documentType: documentData.documentType,
                programCount: documentData.programs.length,
                programs: documentData.programs
            };
            
            history.unshift(historyItem);
            
            if (history.length > 10) {
                history = history.slice(0, 10);
            }
            
            localStorage.setItem(STORAGE_KEYS.documentHistory, JSON.stringify(history));
            updateHistoryPanel();
        }
        
        function updateHistoryPanel() {
            const historyContent = document.getElementById('historyContent');
            const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.documentHistory) || '[]');
            
            if (history.length === 0) {
                historyContent.innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">No documents generated yet</p>';
                return;
            }
            
            historyContent.innerHTML = history.map(item => `
                <div class="history-item" onclick="loadFromHistory('${item.id}')">
                    <strong>${item.clientName}</strong><br>
                    <small>${new Date(item.timestamp).toLocaleString()}</small><br>
                    <small>${item.documentType.toUpperCase()} - ${item.programCount} programs</small>
                </div>
            `).join('');
        }
        
        function loadFromHistory(historyId) {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.documentHistory) || '[]');
            const item = history.find(h => h.id == historyId);
            
            if (item) {
                document.getElementById('clientName').value = item.clientName;
                selectedPrograms = item.programs;
                updateSelectedPrograms();
                displayPrograms();
                toggleHistory();
            }
        }
        
        function toggleHistory() {
            const panel = document.getElementById('historyPanel');
            panel.classList.toggle('active');
            panel.classList.toggle('open');
            if (panel.classList.contains('open')) {
                updateHistoryPanel();
            }
        }
        
        // Export Database
        function exportDatabase() {
            const exportData = {
                version: programDatabase.version,
                exportDate: new Date().toISOString(),
                programs: programs,
                totalPrograms: programs.length
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `aftercare_programs_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Import Database
        function importDatabase() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        if (importData.programs && Array.isArray(importData.programs)) {
                            if (confirm(`Import ${importData.programs.length} programs?`)) {
                                programs.length = 0;
                                programs.push(...importData.programs);
                                displayPrograms();
                                alert('Database imported successfully!');
                            }
                        }
                    } catch(error) {
                        alert('Error importing database: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchBox').focus();
            }
            
            if (e.ctrlKey && e.key === 'g') {
                e.preventDefault();
                generateDocument();
            }
            
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                toggleTheme();
            }
        });
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            // Load theme
            const savedTheme = localStorage.getItem(STORAGE_KEYS.theme);
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '☀️';
                document.getElementById('themeText').textContent = 'Light Mode';
            }
            
            // Update history
            updateHistoryPanel();
            
            // Update compare count
            document.getElementById('compareCount').textContent = '0';
        });
    </script>
</body>
</html>